#!/usr/bin/env bqn
âŸ¨Realpathâ‹„Atâ‹„CreateDirâ‹„Existsâ‹„Removeâ‹„Listâ‹„Bytesâ‹„pathâŸ© â† â€¢file

âŸ¨osâŸ©â†â€¢platform
version â† "5.5"
binariesPath â† "lib"
CreateDirâŸ(Â¬Exists) binariesPath

âŸ¨               ext     â‹„ libFile         â‹„ raylibFolder
âŸ©â†{"darwin":  âŸ¨".tar.gz"â‹„"libraylib.dylib"â‹„"raylib-"âˆ¾versionâˆ¾"_macos"       âŸ©
;  "linux":   âŸ¨".tar.gz"â‹„"libraylib.so"   â‹„"raylib-"âˆ¾versionâˆ¾"_linux_amd64" âŸ©
;  "windows": âŸ¨".zip"   â‹„"raylib.dll"     â‹„"raylib-"âˆ¾versionâˆ¾"_win64_msvc16"âŸ©
} os

git_clone_path â† "https://www.github.com/raysan5/raylib/releases/download/"âˆ¾versionâˆ¾"/"âˆ¾raylibFolderâˆ¾ext

# Expects library to not exist
!âˆ˜{ğ•Š:"raylib already installed. Delete it to re-install.
  rm "âˆ¾(â€¢file.At ğ•©)âˆ¾"
"}âŸExists binariesPath At libFile

# ---------------
# download raylib
# ---------------

Exec â† {eâ€¿Â·â€¿o:o!0â‰¡e}â€¢SH

# Download raylib zip/tar file
Exec {"windows"â‰¡os? # If errors: Curl was likely not found.
  âŸ¨
    "Powershell.exe" â‹„ "-Command"
    "curl -o """âˆ¾(At"temp"âˆ¾ext)âˆ¾""" "âˆ¾git_clone_path
  âŸ©
;
  âŸ¨"curl" â‹„ "-o" â‹„ At"temp"âˆ¾ext â‹„ git_clone_path â‹„ "-L"âŸ©
}
"Downloading raylib failed from github failed. Likely due to redirects not being followed."!âŸ¨âŸ©â‰¢â€¢FBytes "temp"âˆ¾ext

# unzip/untar/unarchive raylib
# tar on windows handles zip files, while mac/linux get raylib as tar.gz files
Exec âŸ¨"tar" â‹„ "-xzf"â‹„Realpath"temp"âˆ¾ext â‹„ "-C"â‹„pathâŸ©
Remove Realpath"temp"âˆ¾ext
"Extracting raylib failed"!Exists raylibFolder At "lib" At libFile

# ---------------------
# Copy binary file to binariesPath
# ---------------------
(binariesPath At libFile) Bytes Bytes Realpath raylibFolder At "lib" At libFile

# -----------------
# Clean away raylib
# -----------------
filesToBeDeleted â† raylibFolderâŠ¸AtÂ¨ âˆ¾âŸ¨
  "lib"    âŠ¸AtÂ¨â€¢file.List raylibFolder At"lib"
  "include"âŠ¸AtÂ¨"raylib.h"â€¿"raymath.h"â€¿"rlgl.h"
  "CHANGELOG"â€¿"LICENSE"â€¿"README.md"
âŸ©
!âˆ˜{ğ•Š:"Unexpected files in "âˆ¾raylibFolderâˆ¾", "âˆ¾â€¢Repr filesToBeDeleted
}âŸ(0â‰ â‰ )Â¬âˆ˜ExistsÂ¨âŠ¸/filesToBeDeleted
RemoveÂ¨filesToBeDeleted
cleaupErrorMsg â† "Cleanup unsuccessful. Please delete "âˆ¾raylibFolderâˆ¾" manually "
RMDirCmd â† {
  osâ‰¡"windows"?
    âŸ¨"Powershell.exe" â‹„ "-Command" â‹„ "RD '"âˆ¾ğ•©âˆ¾"'"âŸ©
; "rmdir"â‹ˆğ•©
}
{cleaupErrorMsg!0â€¿âŸ¨âŸ©â€¿âŸ¨âŸ©â‰¡â€¢SH RMDirCmd Realpath raylibFolder Atğ•©}Â¨"lib"â€¿"include"â€¿""

â€¢Out "raylib installed successfully"
