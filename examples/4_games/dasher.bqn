# Credit: Bugsworth

âŸ¨color
 draw
 key
 rfâ‡raylib
 rmâ‡raymath
âŸ© â† rl â† â€¢Import "../../rayed.bqn"

{ð•Š
    # Initialisation
    position â† 0â€¿0
    direction â† 0â€¿0
    dashDir â† 0â€¿0
    timeSinceSpace â† Â¯âˆž

    # Player features
    staminaLimit â† 100
    staminaComsumption â† 25
    staminaRecovery â† 1
    stamina â† 100

    moveSpeed â† 5
    dashSpeed â† 10

    playerPhase â† âŸ¨color.yellow, color.greenâŸ©

    {ð•Š
        condition â† 0.25 > (â€¢MonoTime@)-timeSinceSpace

        # Space pressed thingy
        {key.IsPressed key.space âˆ§ stamina > 0?
            timeSinceSpace â†© â€¢MonoTime@
            dashDir â†© direction
            stamina -â†© stamina âŒŠ staminaComsumption
            ;@
        }

        # Stamina management
        {(1 < (â€¢MonoTime@)-timeSinceSpace) âˆ§ stamina < staminaLimit?
            stamina +â†© staminaRecovery ; @
        }

        # Directional movement of the player
        position +â†© {condition ?
            dashDir Ã— dashSpeed
            ;
            moveSpeedÃ—rm.Vectornormalize-Ëkey.IsDown ["DS","AW"]
        }
        rf.DrawCircleV positionâ€¿10â€¿(conditionâŠ‘playerPhase)

        # Drawing arrow towards mouse
        oppositeAdjacent â† position - rl.mouse.GetPos@
        direction â†© -rm.Vectornormalize oppositeAdjacent
        color.blue rl.draw.Line +`positionâ‰directionÃ—50

        # Drawing the stamina bar
        color.green rl.draw.Rectangle [50â€¿25 â‹„ 2Ã—(stamina + 25)â€¿10]
    } draw._withCanvasâŸœcolor.black â€¢_while_ (Â¬rl.window.ShouldClose)@

} rl.window._openAs "Game"
