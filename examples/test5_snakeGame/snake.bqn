âŸ¨câ‡color,window,draw,kâ‡keyâŸ©â†râ†â€¢Import "../../raylib.bqn"
size â† 15

GetConsts â† {ğ•¤
  # Line drawing positions
  tileSize â† (âŒŠÂ´window.GetSize@)âŒŠâˆ˜Ã·size+2
  lines    â† (âŒ½Â¨âˆ¾âŠ¢) (âŠ¢âˆ¾âŒœ2â†‘1âŒ½â¼âŠ¢)tileSizeÃ—1+â†•1+size
  tileSizeâ€¿lines
}
OnStart â† {ğ•¤
  frame â† 0 â‹„ speed â† 10
  # 0 is gameOver, 1 is playing, 2 is paused
  gameState â† 1
  # List of xâ€¿y positions of the snake
  snake â† âŸ¨0â€¿0âŸ©
  fruit â† 2 â€¢rand.Range size
  # 0â€¿1 up, 1â€¿0 right, 0â€¿Â¯1 down, Â¯1â€¿0 left
  # first in list is the current facing, pressing right 1âŒ½ pressing left 1âŒ½â¼
  facing â† âŸ¨1â€¿0, 0â€¿Â¯1, Â¯1â€¿0, 0â€¿1âŸ© 
  frameâ€¿gameStateâ€¿snakeâ€¿fruitâ€¿facingâ€¿speed
}
PerFrame â†{tileSizeâ€¿linesğ•Šframeâ€¿gameStateâ€¿snakeâ€¿fruitâ€¿facingâ€¿speed:
  # Drawing
  screens â† âŸ¨
    {ğ•Š:"Game Over" c.black draw._Text_ 20 100â€¿100}
    {ğ•Š:
      c.white draw._LineË˜lines
      ( tileSize-2)  c.red draw._Rectangleâ—‹(2âŠ¸â¥Š) 1+tileSizeÃ—1+fruit
      {(tileSize-2) c.blue draw._Rectangleâ—‹(2âŠ¸â¥Š) 1+tileSizeÃ—ğ•©}Â¨1+snake
    }
    {ğ•Š: "Paused" c.black draw._Text_ 40 100â€¿200}
  âŸ©
  âŠ¢â—¶screens gameState
  (â€¢Repr Â¯1+â‰ snake)c.black draw._Text_ 40 10â€¿10

  # Computing game
  key â† r.rayFFI.GetKeyPressedâŸ¨âŸ©
  pauseP â† key=k.kRIGHT_SHIFT
  newGameState â†{1:2;2:1;ğ•©}âŸpauseP gameState

  NewFruit â† {ğ•Š:â€¢rand.Rangeâˆ˜â‰ âŠ¸âŠ‘ snake(Â¬âˆ˜âˆŠËœ/âŠ¢)â¥Šâ†•2â¥Šsize}
  ExtendSnake â† {Â¯1â†“âŸ(fruitâ‰¢1âŠ‘âŠ¢) ğ•©âˆ¾Ëœ<size|facing+â—‹âŠ‘ğ•©}
  {
    pausePâˆ§0=gameState? OnStart@;
    2=newGameState? newGameStateâŒ¾(1âŠ‘âŠ¢)ğ•©;
    âŸ¨
      frame+1=gameState                         # frame
      newGameStateÃ—â·âŠ¸â‰¡snake                     # gameState
      ExtendSnakeâŸ(1=speed|frameË™)snake         # snake
      NewFruitâŸ((âŠ‘snake)âŠ¸â‰¡âˆ§1=speed|frameË™)fruit # fruit
      facingâŒ½Ëœ-Â´key=k.kLEFTâ€¿k.kRIGHT            # facing 
      2âŒˆspeed+-Â´key=k.kDOWNâ€¿k.kUP               # speed
    âŸ©
  }ğ•©
} draw._withCanvas_ 255â€¿200â€¿0â€¿255

Game â† GetConsts PerFrameâ€¢_While_(Â¬window.ShouldClose) OnStart
Game window._openAs_ "Snake" 1
