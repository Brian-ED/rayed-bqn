## NOT FINISHED

# All shader features working on linux only

âŸ¨color, window, draw, rayffi,keyâŸ©â†râ†â€¢Import "../../raylib.bqn"
âŸ¨materialStructâ‡materialâŸ© â† rayffi
shader_uniform_vec3 â† 2
shader_uniform_vec4 â† 3

# Create a light and get shader locations
CreateLight â† {lightsCountğ•ŠâŸ¨xâ€¿yâ€¿zâ‹„colorâ‹„shaderâŸ©:
  shaderVars â† "enabled"â€¿"type"â€¿"position"â€¿"target"â€¿"color"
  shader UpdateLightValues {
    type           â‡ 1
    enabledâ€¿Toggle â‡ 1â€¿{ğ•Š: enabledÂ¬â†©}
    pos            â‡ xâ€¿yâ€¿z
    target         â‡ 0â€¿0â€¿0
    color          â‡ color
  # NOTE: Lighting shader naming must be the provided ones
    âŸ¨enabledLoc, typeLoc, posLoc, targetLoc, colorLoc
    âŸ© â‡ (rayffi.GetShaderLocation shaderâ‹ˆ"lights["âˆ¾lightsCountâ€¢ReprâŠ¸âˆ¾"]."âˆ¾âˆ¾âŸœ@)Â¨shaderVars
  }
}

# Send light properties to shader
# NOTE: Light shader locations should be available 
UpdateLightValues â† {shaderğ•Šlight:
  shader_uniform_int â† 4
  rayffi.SetShaderValueâŸ¨shader, light.enabledLoc,â‹ˆlight.enabled  , shader_uniform_intâŸ©
  rayffi.SetShaderValueâŸ¨shader, light.typeLoc   ,â‹ˆlight.type     , shader_uniform_intâŸ©
  rayffi.SetShaderValueâŸ¨shader, light.posLoc    ,â‹ˆlight.pos      , shader_uniform_vec3âŸ©
  rayffi.SetShaderValueâŸ¨shader, light.targetLoc ,â‹ˆlight.target   , shader_uniform_vec3âŸ©
  rayffi.SetShaderValueâŸ¨shader, light.colorLoc  ,â‹ˆlight.colorÃ·255, shader_uniform_vec4âŸ©
  light
}

PerFrame â† {shaderâ€¿modelâ€¿cubeâ€¿xxxâ€¿fontğ•Šcameraâ€¿lights:
  rayffi.UpdateCameraâŸ¨cameraâŸ©â€¿2

  # Update the shader with the camera view vector (points towards { 0.0f, 0.0f, 0.0f })
  cameraPos â† âŠ‘camera
  rayffi.SetShaderValueâŸ¨shader, xxx, cameraPos, shader_uniform_vec3âŸ©        

  # Check key inputs to enable/disable lights
  lights{ğ•¨.Toggle@}âŸâŠ¢Â¨key.IsPressedÂ¨âŸ¨key.y, key.r, key.g, key.bâŸ©

  # Update light values (actually, only enable/disable them)
  shaderâŠ¸UpdateLightValuesÂ¨lights

  rayffi.BeginMode3D camera
    rayffi.DrawModel âŸ¨model,0â€¿0â€¿0, 1, color.whiteâŸ©
    rayffi.DrawModel âŸ¨cube, 0â€¿0â€¿0, 1, color.whiteâŸ©

    {
      ğ•©.enabledâ—¶âŸ¨
        rayffi.DrawSphereWiresâŒˆâˆ˜Ã—âŸœ0.3âŒ¾(Â¯1âŠ‘Â¯1âŠ¸âŠ‘)
        rayffi.DrawSphereEx
      âŸ© âŸ¨ğ•©.pos, 0.2, 8, 8, ğ•©.colorâŸ©
    }Â¨lights
    rayffi.DrawGrid 10â€¿1
  rayffi.EndMode3DâŸ¨âŸ©
  rayffi.DrawFPS 10â€¿10

  color.darkGrayâ€¿fontâ€¿20 draw.Text 10â€¿40â‹ˆ"Use keys [Y][R][G][B] to toggle lights"
  MoveCamera â† (key.qâ€¿key.upâ€¿key.e -â—‹(key.IsPressedÂ¨) key.leftâ€¿key.downâ€¿key.right)âŠ¸+âŒ¾âŠ‘
  âŸ¨
    MoveCamera camera
    lights
  âŸ©
}draw._withCanvas_ color.black

{ğ•¤
  rayFFI.SetConfigFlags window.configFlags.msaa_4x_hint  # Enable Multi Sampling Anti Aliasing 4x (if available)
  camera â† âŸ¨
    1â€¿4â€¿6 # position
    0â€¿0â€¿0 # target
    0â€¿1â€¿0 # up         # Camera up vector
    45    # fovy       # Camera field-of-view Y
    0     # projection # Camera projection type
  âŸ©
  font  â† r.font.LoadBQN 100
  plane â† rayffi.LoadModelFromMesh rayffi.GenMeshPlane 10â€¿10â€¿3â€¿3
  cube  â† rayffi.LoadModelFromMesh rayffi.GenMeshCube   2â€¿ 4â€¿2

  # Load basic lighting shader
  shader â† rayffi.LoadShader"lighting.vs"â€¿"lighting.fs"âˆ¾Â¨@

  # Get some required shader locations
  xxxâ†rayffi.GetShaderLocation shaderâ‹ˆ"viewPos"âˆ¾@

  # Ambient light level (some basic lighting)
  ambientLoc â† rayffi.GetShaderLocation shaderâ‹ˆ"ambient"âˆ¾@

  rayffi.SetShaderValueâŸ¨shader, ambientLoc, 1âˆ¾Ëœ3â¥Š0.1, shader_uniform_vec4âŸ©

  # Create lights
  lights â† CreateLightÂ¨ËœâŸœ(â†•â‰ )âŸ¨
    âŸ¨Â¯2â€¿1â€¿Â¯2, color.yellow, shaderâŸ©
    âŸ¨ 2â€¿1â€¿ 2, color.red   , shaderâŸ©
    âŸ¨Â¯2â€¿1â€¿ 2, color.green , shaderâŸ©
    âŸ¨ 2â€¿1â€¿Â¯2, color.blue  , shaderâŸ©
  âŸ©

  shaderâ€¿planeâ€¿cubeâ€¿xxxâ€¿font PerFrameâ€¢_While_(Â¬window.ShouldClose) cameraâ€¿lights

  rayffi.UnloadModel plane
  rayffi.UnloadModel cube
  rayffi.UnloadShader shader
} window._openAs "raylib [shaders] example - basic lighting"
