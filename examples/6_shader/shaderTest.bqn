# THIS EXAMPLE IS INCOMPLETE

âŸ¨color, window, draw, rayffi,keyâŸ©â†râ†â€¢Import "../../raylib.bqn"
# Light data
#  light â† Struct âŸ¨   
#    i      # type
#    i      # bool enabled
#    v3     # position
#    v3     # target
#    color  # color
#    f      # attenuation
#  
#    # Shader locations
#    i # enabledLoc
#    i # typeLoc
#    i # positionLoc
#    i # targetLoc
#    i # colorLoc
#    i # attenuationLoc
#  âŸ©

# Create a light and get shader locations
CreateLight â† {lightsCountğ•ŠintTypeâ€¿v3Posâ€¿v3Targetâ€¿colorâ€¿shader: # i v3 v3 color shader
  light â† âŸ¨
    intType, 1, v3Pos, v3Target, color
    @ # attenuation
  # NOTE: Lighting shader naming must be the provided ones
    rayffi.GetShaderLocation shaderâ€¿"lights["âˆ¾lightsCountâˆ¾"].enabled"
    rayffi.GetShaderLocation shaderâ€¿"lights["âˆ¾lightsCountâˆ¾"].type"
    rayffi.GetShaderLocation shaderâ€¿"lights["âˆ¾lightsCountâˆ¾"].position"
    rayffi.GetShaderLocation shaderâ€¿"lights["âˆ¾lightsCountâˆ¾"].target"
    rayffi.GetShaderLocation shaderâ€¿"lights["âˆ¾lightsCountâˆ¾"].color"
    @ # attenuationLoc
  âŸ©
  shader UpdateLightValues light
}
shader_uniform_int â† 4
shader_uniform_vec3 â† 2
shader_uniform_vec4 â† 3
versionGLSL â† 330
shader_loc_vector_veiw â† 11
shader_loc_matrix_model â† 9

# Send light properties to shader
# NOTE: Light shader locations should be available 
UpdateLightValues â† {shaderğ•Šlight:
  # Send to shader light enabled state and type
  rayffi.SetShaderValue âŸ¨shader, 6âŠ‘light, 1âŠ‘light, shader_uniform_intâŸ©
  rayffi.SetShaderValue âŸ¨shader, 7âŠ‘light,  âŠ‘light, shader_uniform_intâŸ©

  # Send to shader light position values
  position â† 2âŠ‘light
  positionLoc â† 8âŠ‘light
  rayffi.SetShaderValueâŸ¨shader, positionLoc, position, shader_uniform_vec3âŸ©

  # Send to shader light target position values
  target â† 3âŠ‘light
  targetLoc â† 9âŠ‘light
  rayffi.SetShaderValueâŸ¨shader, targetLoc, target, shader_uniform_vec3âŸ©

  # Send to shader light color values
  color â† 255Ã·Ëœ4âŠ‘light
  rayffi.SetShaderValueâŸ¨shader, light.colorLoc, color, shader_uniform_vec4âŸ©
  light
}

LoadConsts â† {ğ•¤
  # Initialization
  rayFFI.SetConfigFlags window.configFlags.msaa_4x  # Enable Multi Sampling Anti Aliasing 4x (if available)

  # Define the camera to look into our 3d world
  camera â† {
    position   â‡ 2â€¿4â€¿6 # Camera position
    target     â‡ 0â€¿0â€¿0 # Camera looking at point
    up         â‡ 0â€¿1â€¿0 # Camera up vector (rotation towards target)
    fovy       â‡ 45    # Camera field-of-view Y
    projection â‡ 0     # Camera projection type
  }

  # Load plane model from a generated mesh
  model â† rayffi.LoadModelFromMesh rayffi.GenMeshPlane 10â€¿10â€¿3â€¿3
  cube  â† rayffi.LoadModelFromMesh rayffi.GenMeshCube   2â€¿ 4â€¿2

  # Load basic lighting shader
  shader â† rayffi.LoadShader"lighting.vs"â€¿"lighting.fs"âˆ¾Â¨@
  # Get some required shader locations
  # shader rayffi.GetShaderLocationâˆ˜shaderâ€¿("viewPos"âˆ¾@)âŒ¾(shader_loc_vector_veiwâŠ‘âŸœâ€¢Show 1âŠ‘âŠ¢)â†©

  # Ambient light level (some basic lighting)
  ambientLoc â† rayffi.GetShaderLocation shaderâ€¿("ambient"âˆ¾@)
  rayffi.SetShaderValueâŸ¨shader, ambientLoc, 1âˆ¾Ëœ3â¥Š0.1, shader_uniform_vec4âŸ©

  # Assign out lighting shader to model;
  modelâ€¿cube shaderâŒ¾{0âŠ‘4âŠ‘ğ•©}Â¨â†©

  # Create lights
  lights â† CreateLightÂ¨ËœâŸœ(â†•â‰ )âŸ¨
    âŸ¨1, Â¯2â€¿1â€¿Â¯2, 0â€¿0â€¿0, color.yellow, shaderâŸ©
    âŸ¨1,  2â€¿1â€¿ 2, 0â€¿0â€¿0, color.red,    shaderâŸ©
    âŸ¨1, Â¯2â€¿1â€¿ 2, 0â€¿0â€¿0, color.green,  shaderâŸ©
    âŸ¨1,  2â€¿1â€¿Â¯2, 0â€¿0â€¿0, color.blue,   shaderâŸ©
  âŸ©
  cameraâ€¿shaderâ€¿lightsâ€¿modelâ€¿cube
}
PerFrame â† {cameraâ€¿shaderâ€¿lightsâ€¿modelâ€¿cubeğ•Šğ•©:
  rayffi.UpdateCamera cameraâ€¿2

  # Update the shader with the camera view vector (points towards { 0.0f, 0.0f, 0.0f })
  cameraPos â† camera.position
  rayffi.SetShaderValueâŸ¨shader, shader_loc_vector_veiwâŠ‘1âŠ‘shader, cameraPos, SHADER_UNIFORM_VEC3âŸ©

  # Check key inputs to enable/disable lights
  lights{Â¬âŸ(r.key.IsPressedğ•©)âŒ¾(1âŠ¸âŠ‘)ğ•¨}Â¨â†©âŸ¨key.kY, key.kR, key.kG, key.kBâŸ©
  
  # Update light values (actually, only enable/disable them)
  shaderâŠ¸UpdateLightValuesÂ¨lights

  rayffi.BeginMode3D camera
    rayffi.DrawModel âŸ¨model,0â€¿0â€¿0, 1, color.whiteâŸ©
    rayffi.DrawModel âŸ¨cube, 0â€¿0â€¿0, 1, color.whiteâŸ©

    {2âŠ‘ğ•©? rayffi.DrawSphereEx âŸ¨2âŠ‘ğ•©, 0.2, 8, 8, 4âŠ‘ğ•©âŸ©;
      rayffi.DrawSphereWires  âŸ¨2âŠ‘ğ•©, 0.2, 8, 8, rayffi.ColorAlphaâŸ¨4âŠ‘ğ•©, 0.3âŸ©âŸ©
    }Â¨lights

    rayffi.DrawGrid 10â€¿1
  rayffi.EndMode3DâŸ¨âŸ©
  rayffi.DrawFPS 10â€¿10

  rayffi.DrawText "Use keys [Y][R][G][B] to toggle lights"â€¿10â€¿40â€¿20â€¿color.darkGray

}draw._withCanvas_ color.white

Unload â† {ğ•Šcameraâ€¿shaderâ€¿lightsâ€¿modelâ€¿cube:
  â€¢Show rayffi.CompressData "hello"â€¿5â€¿5
  â€¢Exit@
  # De-Initialization
  rayffi.UnloadModel model     # Unload the model
  rayffi.UnloadModel cube      # Unload the model
  rayffi.UnloadShader shader   # Unload shader
}
Game â† Unload LoadConsts PerFrameâ€¢_While_(Â¬window.ShouldClose) âŠ¢
Game window._openAs "raylib [shaders] example - basic lighting"
