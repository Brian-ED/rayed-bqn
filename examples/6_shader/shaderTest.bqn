# THIS EXAMPLE IS INCOMPLETE

âŸ¨color, window, draw, rayffi,keyâŸ©â†râ†â€¢Import "../../raylib.bqn"
âŸ¨materialStructâ‡materialâŸ© â† rayffi
xxxâ†@
# Create a light and get shader locations
CreateLight â† {lightsCountğ•ŠintTypeâ€¿v3Posâ€¿v3Targetâ€¿colorâ€¿shader: # i v3 v3 color shader
  light â† âŸ¨
    intType, 1, v3Pos, v3Target, color
    @ # attenuation
  # NOTE: Lighting shader naming must be the provided ones
    rayffi.GetShaderLocation shaderâ‹ˆ"lights["âˆ¾lightsCountâˆ¾"].enabled"
    rayffi.GetShaderLocation shaderâ‹ˆ"lights["âˆ¾lightsCountâˆ¾"].type"
    rayffi.GetShaderLocation shaderâ‹ˆ"lights["âˆ¾lightsCountâˆ¾"].position"
    rayffi.GetShaderLocation shaderâ‹ˆ"lights["âˆ¾lightsCountâˆ¾"].target"
    rayffi.GetShaderLocation shaderâ‹ˆ"lights["âˆ¾lightsCountâˆ¾"].color"
    @ # attenuationLoc
  âŸ©
  shader UpdateLightValues light
}
shader_uniform_int â† 4
shader_uniform_vec3 â† 2
shader_uniform_vec4 â† 3
versionGLSL â† 330
shader_loc_vector_veiw â† 11
shader_loc_matrix_model â† 9

# Send light properties to shader
# NOTE: Light shader locations should be available 
UpdateLightValues â† {shaderğ•Šlight:
  # Send to shader light enabled state and type
  rayffi.SetShaderValue âŸ¨shader, 6âŠ‘light, âŸ¨1âŠ‘lightâŸ©, shader_uniform_intâŸ©
  rayffi.SetShaderValue âŸ¨shader, 7âŠ‘light,  âŸ¨âŠ‘lightâŸ©, shader_uniform_intâŸ©

  # Send to shader light position values
  position â† 2âŠ‘light
  positionLoc â† 8âŠ‘light
  rayffi.SetShaderValueâŸ¨shader, positionLoc, position, shader_uniform_vec3âŸ©

  # Send to shader light target position values
  target â† 3âŠ‘light
  targetLoc â† 9âŠ‘light
  rayffi.SetShaderValueâŸ¨shader, targetLoc, target, shader_uniform_vec3âŸ©

  # Send to shader light color values
  color â† 255Ã·Ëœ4âŠ‘light
  rayffi.SetShaderValueâŸ¨shader, Â¯2âŠ‘light, color, shader_uniform_vec4âŸ©
  light
}

LoadConsts â† {ğ•¤
  # Initialization
  rayFFI.SetConfigFlags window.configFlags.msaa_4x  # Enable Multi Sampling Anti Aliasing 4x (if available)

  # Define the camera to look into our 3d world
  camera â† âŸ¨
    2â€¿4â€¿6 # position   # Camera position
    0â€¿0â€¿0 # target     # Camera looking at point
    0â€¿1â€¿0 # up         # Camera up vector (rotation towards target)
    45    # fovy       # Camera field-of-view Y
    0     # projection # Camera projection type
  âŸ©

  # Load plane model from a generated mesh
  model â† rayffi.LoadModelFromMesh rayffi.GenMeshPlane 10â€¿10â€¿3â€¿3
  cube  â† rayffi.LoadModelFromMesh rayffi.GenMeshCube   2â€¿ 4â€¿2

  # Load basic lighting shader
  shader â† rayffi.LoadShader"lighting.vs"â€¿"lighting.fs"âˆ¾Â¨@
  # Get some required shader locations
  
  mutateAtIndex â†  @â€¢FFI""â€¿"bqn_readI32Arr"â€¿"ğ•¨>a"â€¿"ğ•©>*:i8"
  p â† (4Ã—shader_loc_vector_veiw) {bâ†256â‹†â†•8 â‹„ -âŸœ(256Ã—â‰¥âŸœ128) 256|âŒŠÃ·âŸœb ğ•¨++Â´bÃ—256|ğ•©} 1âŠ‘shader
  p MutateAtIndexËœâ‹ˆxxxâ†©rayffi.GetShaderLocation shaderâ‹ˆ"viewPos"âˆ¾@

  # Ambient light level (some basic lighting)
  ambientLoc â† rayffi.GetShaderLocation shaderâ‹ˆ"ambient"âˆ¾@

  rayffi.SetShaderValueâŸ¨shader, ambientLoc, 1âˆ¾Ëœ3â¥Š0.1, shader_uniform_vec4âŸ©

  # Assign out lighting shader to model
  materialsIndexâ†5

#    model.materials[0].shader = shader;
#    cube .materials[0].shader = shader;

#  p1 â† materialsIndexâŠ‘model
#  p2 â† materialsIndexâŠ‘cube

#  modelâ€¿cube shaderâŒ¾(0âŠ‘4âŠ‘âŠ¢)Â¨â†©

  # Create lights
  lights â† CreateLightÂ¨ËœâŸœ(â†•â‰ )âŸ¨
    âŸ¨1, Â¯2â€¿1â€¿Â¯2, 0â€¿0â€¿0, color.yellow, shaderâŸ©
    âŸ¨1,  2â€¿1â€¿ 2, 0â€¿0â€¿0, color.red,    shaderâŸ©
    âŸ¨1, Â¯2â€¿1â€¿ 2, 0â€¿0â€¿0, color.green,  shaderâŸ©
    âŸ¨1,  2â€¿1â€¿Â¯2, 0â€¿0â€¿0, color.blue,   shaderâŸ©
  âŸ©
  cameraâ€¿shaderâ€¿lightsâ€¿modelâ€¿cube
}
PerFrame â† {cameraâ€¿shaderâ€¿lightsâ€¿modelâ€¿cubeğ•Šğ•©:
  rayffi.UpdateCameraâŸ¨cameraâŸ©â€¿2

  # Update the shader with the camera view vector (points towards { 0.0f, 0.0f, 0.0f })
  cameraPos â† âŠ‘camera
  rayffi.SetShaderValueâŸ¨shader, xxx, cameraPos, shader_uniform_vec3âŸ©        

  # Check key inputs to enable/disable lights
  lights{Â¬âŸ(r.key.IsPressedğ•©)âŒ¾(1âŠ¸âŠ‘)ğ•¨}Â¨â†©âŸ¨key.kY, key.kR, key.kG, key.kBâŸ©
  
  # Update light values (actually, only enable/disable them)
  shaderâŠ¸UpdateLightValuesÂ¨lights

  rayffi.BeginMode3D camera
    rayffi.DrawModel âŸ¨model,0â€¿0â€¿0, 1, color.whiteâŸ©
    rayffi.DrawModel âŸ¨cube, 0â€¿0â€¿0, 1, color.whiteâŸ©

    {0â‰¢6âŠ‘ğ•©? rayffi.DrawSphereEx âŸ¨2âŠ‘ğ•©, 0.2, 8, 8, 4âŠ‘ğ•©âŸ©;
      rayffi.DrawSphereWires  âŸ¨2âŠ‘ğ•©, 0.2, 8, 8, rayffi.ColorAlphaâŸ¨4âŠ‘ğ•©, 0.3âŸ©âŸ©
    }Â¨lights
    rayffi.DrawGrid 10â€¿1
  rayffi.EndMode3DâŸ¨âŸ©
  rayffi.DrawFPS 10â€¿10

  rayffi.DrawText "Use keys [Y][R][G][B] to toggle lights"â€¿10â€¿40â€¿20â€¿color.darkGray

}draw._withCanvas_ color.white

Unload â† {ğ•Šcameraâ€¿shaderâ€¿lightsâ€¿modelâ€¿cube:
  rayffi.UnloadModel model
  rayffi.UnloadModel cube
  rayffi.UnloadShader shader
}
Game â† Unload LoadConsts PerFrameâ€¢_While_(Â¬window.ShouldClose) âŠ¢
Game window._openAs "raylib [shaders] example - basic lighting"
