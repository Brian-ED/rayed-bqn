âŸ¨rfâ‡raylib, key, color, drawâŸ© â† rl â† â€¢Import "../../rayed.bqn"

max_columns â† 20

cameraIndex â† {
  position   â‡ 0 # Camera position
  target     â‡ 1 # Camera target it looks-at
  up         â‡ 2 # Camera up vector (rotation over its axis)
  fovy       â‡ 3 # Camera field-of-view aperture in Y (degrees) in perspective, used as near plane width in orthographic
  projection â‡ 4 # Camera projection: CAMERA_PERSPECTIVE or CAMERA_ORTHOGRAPHIC
}

# Generates some random columns
heights â† 1+â€¢rand.RangeÂ¨max_columnsâ¥Š13
positions â† <Ë˜â‰[Â¯15+â€¢rand.RangeÂ¨max_columnsâ¥Š30, max_columnsâ¥Šmax_columnsÃ·2, Â¯15+â€¢rand.RangeÂ¨max_columnsâ¥Š30]
colors â† â‰[
  20+â€¢rand.RangeÂ¨max_columnsâ¥Š235
  10+â€¢rand.RangeÂ¨max_columnsâ¥Š45
  max_columnsâ¥Š30
  max_columnsâ¥Š255
]

stutâ†1
PerFrameâ†{ğ•Šcameraâ€¿cameraMode:
  stutâ‰ â†©rl.key.IsPressed key.g

  rl.window.SetFPS stutâŠ‘ 1000â€¿60
  rf.DrawFPS 200â€¿0
  # Switch camera mode
  {ğ•¤
    cameraMode â†© rf.cameraMode.camera_free
    camera 0â€¿1â€¿0âŒ¾(cameraIndex.upâŠ¸âŠ‘)â†©  # Reset roll
  }âŸâŠ¢key.IsPressed key.one

  {ğ•¤
    cameraMode â†© rf.cameraMode.camera_first_person
    camera 0â€¿1â€¿0âŒ¾(cameraIndex.upâŠ¸âŠ‘)â†©  # Reset roll
  }âŸâŠ¢key.IsPressed key.two

  {ğ•¤
    cameraMode â†© rf.cameraMode.camera_third_person
    camera 0â€¿1â€¿0âŒ¾(cameraIndex.upâŠ¸âŠ‘)â†©  # Reset roll
  }âŸâŠ¢key.IsPressed key.three

  {ğ•¤
    cameraMode â†© rf.cameraMode.camera_orbital;
    camera 0â€¿1â€¿0âŒ¾(cameraIndex.upâŠ¸âŠ‘)â†©  # Reset roll
  }âŸâŠ¢key.IsPressed key.four

  # Switch camera projection
  camera {ğ•¤
    (cameraIndex.projectionâŠ‘ğ•©) = rf.cameraProjection.camera_perspective?
      # Create isometric view
      cameraMode â†© rf.cameraMode.camera_third_person
      # Note: The target distance is related to the render distance in the orthographic projection
      newCam â† âŸ¨
        0â€¿2â€¿Â¯100
        0â€¿2â€¿   0
        0â€¿1â€¿0  # Reset roll
        20 # near plane width in CAMERA_ORTHOGRAPHIC
        rf.cameraProjection.camera_orthographic
      âŸ©
      newCam rl.camera.CameraYaw  Ëœâ†©âŸ¨Â¯135Ã—Ï€Ã·180, 1âŸ©
      newCam rl.camera.CameraPitchËœâ†©âŸ¨ Â¯45Ã—Ï€Ã·180, 1, 1, 0âŸ©
      newCam
  ; (cameraIndex.projectionâŠ‘ğ•©) = rf.cameraProjection.camera_orthographic?

    # Reset to default view
    cameraMode â†© rf.cameraMode.camera_third_person
    âŸ¨
      0â€¿2â€¿10
      0â€¿2â€¿ 0
      0â€¿1â€¿0 # Reset roll
      60
      rf.cameraProjcection.camera_perspective
    âŸ©
  }âŸ(key.IsPressed key.p) â†©

  # Update camera computes movement internally depending on the camera mode
  # Some default standard keyboard/mouse inputs are hardcoded to simplify use
  # For advance camera controls, it's reecommended to compute camera movement manually
  camera rl.camera.UpdateCameraËœ â†© cameraModeâ‹ˆrf.GetMouseDeltaâŸ¨âŸ©

  # Draw
  {ğ•¤
    {ğ•¤

      rf.DrawPlaneâŸ¨   0â€¿0  â€¿ 0, 32â€¿32, color.lightgray   âŸ© # Draw ground
      rf.DrawCube âŸ¨ Â¯16â€¿2.5â€¿ 0, 1    , 5, 32, color.blue âŸ© # Draw a blue wall
      rf.DrawCube âŸ¨  16â€¿2.5â€¿ 0, 1    , 5, 32, color.lime âŸ© # Draw a green wall
      rf.DrawCube âŸ¨   0â€¿2.5â€¿16, 32   , 5, 1 , color.gold âŸ© # Draw a yellow wall

      # Draw some cubes around
      {ğ•¤
        rf.DrawCube     âŸ¨ğ•©âŠ‘positions, 2, ğ•©âŠ‘heights, 2, ğ•©âŠcolorsâŸ©
        rf.DrawCubeWiresâŸ¨ğ•©âŠ‘positions, 2, ğ•©âŠ‘heights, 2, color.maroonâŸ©
      }Â¨â†•max_columns

      # Draw player cube
      {ğ•¤
        rf.DrawCube     âŸ¨cameraIndex.targetâŠ‘camera, 0.5, 0.5, 0.5, color.purpleâŸ©
        rf.DrawCubeWiresâŸ¨cameraIndex.targetâŠ‘camera, 0.5, 0.5, 0.5, color.darkpurpleâŸ©
      }âŸâŠ¢cameraMode = rf.cameraMode.camera_third_person

    } draw._in3D camera

    # Draw info boxes
    rf.DrawRectangle     âŸ¨5, 5, 530, 150, âŒˆâˆ˜Ã·âŸœ2âŒ¾(3âŠ¸âŠ‘)color.skyblueâŸ©
    rf.DrawRectangleLinesâŸ¨5, 5, 530, 150, color.blueâŸ©

    TextJâ†{yğ•Št:rf.DrawTextâŸ¨t,15,y,20,color.blackâŸ©}

    âŸ¨
      TextJâŸœ"Camera controls:"
      TextJâŸœ"- Move keys: W, A, S, D, Space, Left-Ctrl"
      TextJâŸœ"- Look around: arrow keys or mouse"
      TextJâŸœ"- Camera mode keys: 1, 2, 3, 4"
      TextJâŸœ"- Zoom keys: num-plus, num-minus or mouse scroll"
      TextJâŸœ"- Camera projection key: P"
    âŸ©{ğ•ğ•©}Â¨20Ã—1+â†•6
    rf.DrawRectangleâŸ¨600, 5, 195, 100, âŒˆâˆ˜Ã·âŸœ2âŒ¾(3âŠ¸âŠ‘)color.skyblueâŸ©
    rf.DrawRectangleLinesâŸ¨600, 5, 195, 100, color.blueâŸ©

    rf.DrawTextâŸ¨"Camera status:", 610, 15, 10, color.blackâŸ©

    modeText â† {
      [a,b] â† â‰[
        rf.cameraMode.camera_free        â€¿"FREE"
        rf.cameraMode.camera_first_personâ€¿"FIRST_PERSON"
        rf.cameraMode.camera_third_personâ€¿"THIRD_PERSON"
        rf.cameraMode.camera_orbital     â€¿"ORBITAL"
      ]
      bâˆ¾â†©<"CUSTOM"
      bâŠ‘ËœâŠ‘cameraModeâŠËœa
    }
    projText â† {
      [a,b] â† â‰[
        rf.cameraProjection.camera_perspective â€¿"PERSPECTIVE"
        rf.cameraProjection.camera_orthographicâ€¿"ORTHOGRAPHIC"
      ]
      bâˆ¾â†©<"CUSTOM"
      bâŠ‘ËœâŠ‘aâŠcameraIndex.projectionâŠ‘camera # camera.projection will error
    }
    TextI â† {ğ•Štâ€¿y:rf.DrawTextâŸ¨t, 610, y, 15, color.blackâŸ©}
    TextIâŸ¨"- Mode: "âˆ¾modeText, 30âŸ©
    TextIâŸ¨"- Projection: "âˆ¾projText, 45âŸ©
    R â† 1â†“Â·âˆ¾' 'âˆ¾Â¨â€¢ReprÂ¨
    TextIâŸ¨"- Position: ("âˆ¾')'âˆ¾ËœR cameraIndex.positionâŠ‘camera, 60âŸ©
    TextIâŸ¨"- Target: ("  âˆ¾')'âˆ¾ËœR cameraIndex.targetâŠ‘camera, 75âŸ©
    TextIâŸ¨"- Up: ("      âˆ¾')'âˆ¾ËœR cameraIndex.upâŠ‘camera, 90âŸ©

  }draw._withCanvasâŸœcolor.raywhite @
  cameraâ€¿cameraMode
} â€¢_While_(Â¬rl.window.ShouldClose)

rl.window.SetSize 0.5

PerFrameâˆ˜{ğ•¤
rl.window.SetFullscreen 0
  rf.DisableCursorâŸ¨âŸ©                    # Limit cursor to relative movement inside the window
  camera â† âŸ¨
    0â€¿2â€¿4    # Camera position
    0â€¿2â€¿0    # Camera target, its looking at point
    0â€¿1â€¿0    # Camera up vector (rotation towards target)
    60       # FOV, Camera field-of-view Y
    rf.cameraProjection.camera_perspective # Camera projection type
  âŸ©
  # Define the camera to look into our 3d world (position, target, up vector)
  cameraMode â† rf.cameraMode.camera_free

  cameraâ€¿cameraMode
} rl.window._openAs "raylib [core] example - 3d camera first person"