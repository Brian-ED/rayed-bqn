# depending on rlgl version, you can set this to 100, 120, and 330
glslVersion â† 330

âŸ¨
  color, window, draw, low, key
  rfâ‡raylib, rmâ‡raymath
âŸ© â† rl â† â€¢Import "../../rayed.bqn"
rlights â† â€¢Import "rlights.bqn"

cameraIndex â† {
  position   â‡ 0 # Camera position
  target     â‡ 1 # Camera target it looks-at
  up         â‡ 2 # Camera up vector (rotation over its axis)
  fovy       â‡ 3 # Camera field-of-view aperture in Y (degrees) in perspective, used as near plane width in orthographic
  projection â‡ 4 # Camera projection: CAMERA_PERSPECTIVE or CAMERA_ORTHOGRAPHIC
}

shaderIndex â† { # Shader
  id   â‡ 0 # u     # Shader program id
  locs â‡ 1 # "*"âˆ¾i # Shader locations array (RL_MAX_SHADER_LOCATIONS)
}

modelIndex â† { # Model, meshes, materials and animation data
  transform     â‡ 0 # matrix         # Local transform matrix
  meshCount     â‡ 1 # i              # Number of meshes
  materialCount â‡ 2 # i              # Number of materials
  meshes        â‡ 3 # "*"âˆ¾mesh       # Meshes array
  materials     â‡ 4 # "*"âˆ¾material   # Materials array
  meshMaterial  â‡ 5 # "*"âˆ¾i          # Mesh material number
  boneCount     â‡ 6 # i              # Number of bones
  bones         â‡ 7 # "*"âˆ¾boneInfo   # Bones information (skeleton)
  bindPose      â‡ 8 # "*"âˆ¾transform  # Bones base transformation (pose)
}

materialIndex â‡ âŸ¨ # Material, includes shader and maps
  shader â‡ 0 # shader          # Material shader
  maps   â‡ 1 # "*"âˆ¾materialMap # Material maps array (MAX_MATERIAL_MAPS)
  params â‡ 2 # "[4]"âˆ¾f         # Material generic parameters (if required)
âŸ©

#------------------------------------------------------------------------------------
# Program main entry point
#--------------------------------------------------------------------------------------

rf.SetConfigFlags rf.configFlags.flag_msaa_4x_hint  # Enable Multi Sampling Anti Aliasing 4x (if available)

# sets window size to half the monitor size
window.SetSize 0.5

NestedStructToStr1 â† {
  1â‰¥â‰¡ğ•©?ğ•©;
  F: {'{'âˆ¾'}'Â«âˆ¾','âˆ¾Â¨FÂ¨"*:i8"âŸ('*'â‰¡âŠ‘)âŸ(Ã—â‰ )Â¨ğ•©}âŒ¾(((0=â‰¡Â¨)âŠ¸/ğ•©)âŠ¸âˆ¾â¼)ğ•©
}

NestedStructToStr2 â† {
  1â‰¥â‰¡ğ•©?ğ•©;
  F: {'{'âˆ¾'}'Â«âˆ¾','âˆ¾Â¨FÂ¨ğ•©}âŒ¾(((0=â‰¡Â¨)âŠ¸/ğ•©)âŠ¸âˆ¾â¼)ğ•©
}
mesh â† NestedStructToStr1 rf.mesh
model â† NestedStructToStr2 rf.model
shaderT â† NestedStructToStr2 rf.shader
                                       # vsFileName fsFileName                                             # Load shader from files and bind default locations
{ğ•¤
  # Define the camera to look into our 3d world
  cameraOrig â† âŸ¨
    2â€¿4  â€¿6 # Camera position
    0â€¿0.5â€¿0 # Camera looking at point
    0â€¿1  â€¿0 # Camera up vector (rotation towards target)
    45      # Camera field-of-view Y
    rf.cameraProjection.camera_perspective # Camera projection type
  âŸ©
  # Load plane model from a generated mesh
  model â† rl.model.LoadFromMesh rf.GenMeshPlane 10â€¿10â€¿3â€¿3
  model2 â† rl.model.LoadFromMesh rf.GenMeshPlane 10â€¿10â€¿3â€¿3

  cube  â† rl.model.LoadFromMesh rf.GenMeshCube 2â€¿4â€¿2
  # Load basic lighting shader
  shader â† rf.LoadShader â€¢file.AtÂ¨ "vs"â€¿"fs"âˆ¾ËœÂ¨<"shaders/glsl"âˆ¾"/lighting."âˆ¾Ëœâ€¢Repr glslVersion

  # Get some required shader locations
  veiwPos â† rf.GetShaderLocation shaderâ€¿"viewPos"
  {
    locsPtr â† shaderIndex.locsâŠ‘shader
    rf.shaderLocationIndex.shader_loc_vector_view locsPtr.Write veiwPos
  }

  # Ambient light level, makes it so when no lights are on it's gray instead of black
  {
    ambientLoc â† rf.GetShaderLocation shaderâ€¿"ambient"
    rf.SetShaderValueRawâŸ¨shader, ambientLoc, low.F32ToI8 4â¥Š1, rf.shaderUniformDataType.shader_uniform_vec4âŸ©
  }

  # Assign out lighting shader to model
  {
    (ğ•©.Field 0).Write shader
  }Â¨modelIndex.materialsâŠ¸âŠ‘Â¨cubeâ€¿model

  # Create lights
  lt â† rlights.lightType.light_point
  lights â† rlights.CreateLightÂ¨âŸ¨
    âŸ¨lt, Â¯2â€¿1â€¿Â¯2, 0â€¿0â€¿0, color.yellow, shaderâŸ©
    âŸ¨lt,  2â€¿1â€¿ 2, 0â€¿0â€¿0, color.red   , shaderâŸ©
    âŸ¨lt, Â¯2â€¿1â€¿ 2, 0â€¿0â€¿0, color.green , shaderâŸ©
    âŸ¨lt,  2â€¿1â€¿Â¯2, 0â€¿0â€¿0, color.blue  , shaderâŸ©
  âŸ©
  #--------------------------------------------------------------------------------------

  # Main game loop
  {ğ•ŠcameraOld:
    # Update
    #----------------------------------------------------------------------------------
    âŸ¨âŸ¨cameraâŸ©âŸ© â† rf.UpdateCameraRefâŸ¨â‹ˆcameraOldâ‹„rf.cameraMode.camera_orbitalâŸ©

    # Update the shader with the camera view vector (points towards { 0.0f, 0.0f, 0.0f })
    rf.SetShaderValueRawâŸ¨
      shader, veiwPos
      low.F32ToI8 cameraIndex.positionâŠ‘camera
      rf.shaderUniformDataType.shader_uniform_vec3
    âŸ©

    # Check key inputs to enable/disable lights
    lights {
      Â¬âŒ¾(rlights.lightIndex.enabledâŠ¸âŠ‘)âŸ(rl.key.IsPressed ğ•©)ğ•¨
    }Â¨â†© âŸ¨ key.y â‹„ key.r â‹„ key.g â‹„ key.b âŸ©
    
    # Update light values (actually, only enable/disable them)
    shaderâŠ¸rlights.UpdateLightValuesÂ¨ lights
    #----------------------------------------------------------------------------------

    # Draw
    #----------------------------------------------------------------------------------
    {ğ•¤
      {ğ•¤
        rf.DrawModelâŸ¨model, 0â€¿0â€¿0, 1, color.whiteâŸ©
        rf.DrawModelâŸ¨cube , 0â€¿0â€¿0, 1, color.whiteâŸ©

        # Draw spheres to show where the lights are
        lâ†rlights.lightIndex
        {l.enabledâŠ‘ğ•©?
          rf.DrawSphereEx   âŸ¨l.positionâŠ‘ğ•©, 0.2, 8, 8, l.colorâŠ‘ğ•©âŸ©
        ; rf.DrawSphereWiresâŸ¨l.positionâŠ‘ğ•©, 0.2, 8, 8, âŒˆ0.3âŠ¸Ã—âŒ¾(3âŠ¸âŠ‘)l.colorâŠ‘ğ•©âŸ©
        }Â¨lights
        rf.DrawGrid 10â€¿1
      } rl.draw._in3D camera

      rf.DrawFPS 10â€¿10
      rf.DrawTextâŸ¨"Use keys [Y][R][G][B] to toggle lights", 10, 40, 20, color.darkgrayâŸ©
    } draw._withCanvas_ color.raywhite @
    camera
    #----------------------------------------------------------------------------------
  } â€¢_While_(Â¬window.ShouldClose) cameraOrig

  # De-Initialization
  #--------------------------------------------------------------------------------------
  rf.UnloadModel  model    # Unload the model
  rf.UnloadModel  cube     # Unload the model
  rf.UnloadShader shader   # Unload shader

} window._openAs "raylib [shaders] example - basic lighting"

