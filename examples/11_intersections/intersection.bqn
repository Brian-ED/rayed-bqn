âŸ¨color
 draw
 key
 rfâ‡rayffi
 rmâ‡raymath
âŸ©â†rlâ†â€¢Import "../../raylib.bqn"

# Check if point is inside rectangle
CheckCollision0ToRec â† âˆ§Â´(â‰¤âŸœ0âˆ¾0âŠ¸â‰¤)Ëâˆ˜â‰

# intersection using the slab method
# https://tavianator.com/2011/ray_box.html#:~:text=The%20fastest%20method%20for%20performing,remains%2C%20it%20intersected%20the%20box.
RayIntersectRect â† {directionğ•Šbox: # v2ğ•Š[v2,v2] â†’ v2
  minParamâ€¿maxParam â† âŒˆÂ´âŠ¸âˆ¾âŸœ(âŒŠÂ´)Ëâ‰{ğ•Šdirâ€¿posâ€¿siz:
    (âŒŠÂ´â‹ˆâŒˆÂ´) dirÃ·Ëœposâ€¿siz
  }Ë˜â‰[direction]âˆ¾box
  {
    âˆ§Â´(<âŸœ0âˆ¾0âŠ¸<)Ëbox?
      0â€¿0
  ;
    {ğ•¤
      directionÃ—minParam
    }âŸ(maxParam>0âŒˆminParam)âˆÃ—0âŠ¸=âŠ¸+Ã—direction  # if maxParam < 0, ray is intersecting AABB, but the whole AABB is behind us # if minParam > maxParam, ray doesn't intersect AABB
  }
}

CheckCollisionRay2dCircle â† {ğ•ŠâŸ¨
    direction  # v2
    center     # v2
    radius     # f
  âŸ©:
  {
    radius>+Â´âŒ¾(Ã—Ëœ)center?
      0â€¿0
  ;
    dot â† 0âŒˆ+Â´directionÃ—center
    (+Â´âŒ¾(Ã—Ëœ)center-directionÃ—dot){
      directionÃ—dot-radius-âŒ¾(Ã—Ëœ)ğ•¨
    }âŸ(<âŸœradius)âˆÃ—0âŠ¸=âŠ¸+direction
  }
}
{ğ•¤
  box â† [100â€¿100
         300â€¿150]
  origin    â† 450â€¿300
  direction â† 0â€¿Â¯1
  center    â† 600â€¿200
  radius    â† 50
  intersect â† âˆâ€¿âˆ
  colors    â† color.grayâ€¿color.red
  walkSpeed â† 3
  turnSpeed â† 3

  # Main game loop
  
  #ori â† 5â€¿5
  #â€¢Show âŒˆËâ‰[1â€¿1,4â€¿4]
  #â€¢Show -âŒŠÂ´-âŸœoriÂ¨âŸ¨Â¯1â€¿1,4â€¿4âŸ©

  Rotate â† (â‹ˆâŸœ-Â´â‰âŒ½)â€¢math.Cosâˆ¾â€¢math.Sin
  {ğ•¤
    angleDelta â† turnSpeedÃ—rf.GetFrameTimeâˆ˜âŸ¨âŸ©âŠ¸Ã—-Â´key.IsDown key.rightâ€¿key.left
    direction rm.MPËœâ†© Rotate angleDelta
    origin +â†© walkSpeedÃ—-Ëkey.IsDown ["DS","AW"]
    touchedRecâ€¿touchedCir â† {
      intersect â†©â€¢Show originâŠ¸+(>â—‹|âŠ‘âˆ¾)Â¨Â´ ğ•©
      âˆâ€¿âˆâŠ¸â‰¢Â¨|ğ•©
    } âŸ¨
      direction RayIntersectRect -âŸœoriginË˜box
      CheckCollisionRay2dCircle directionâ€¿(center-origin)â€¿radius
    âŸ©
    box rl.draw.RectangleËœ touchedRecâŠ‘colors
    rf.DrawCircleVâŸ¨centerâ‹„radiusâ‹„touchedCirâŠ‘colorsâŸ©
    rf.DrawCircleV originâ€¿10â€¿color.yellow
    rf.DrawCircleV intersectâ€¿5â€¿color.green
    color.blue rl.draw.Line +`originâ‰directionÃ—500
  } draw._withCanvas_ color.black â€¢_while_ (Â¬rl.window.ShouldClose)@
} rl.window._openAs "raylib extras [Math2d] example - ray rect intersection"