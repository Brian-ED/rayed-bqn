# translated from https://github.com/raylib-extras/examples-c/blob/main/ray2d_rect_intersection/ray2d_rect_intersection.c

âŸ¨color
 draw
 key
 rfâ‡rayffi
 rmâ‡raymath
âŸ©â†rlâ†â€¢Import "../../raylib.bqn"

# intersection using the slab method
# https://tavianator.com/2011/ray_box.html#:~:text=The%20fastest%20method%20for%20performing,remains%2C%20it%20intersected%20the%20box.
RayIntersectRect â† {directionğ•Šbox: # v2ğ•Š[v2,v2] â†’ v2
  minParamâ€¿maxParam â† 0âŒˆâŒˆÂ´âŠ¸âˆ¾âŸœ(âŒŠÂ´)Ëâ‰âˆ§Ë˜directionÃ·Ëœâ‰box
  {maxParam>minParam?
    directionÃ—minParam
  ;
    âˆâŠ¸Ã—âŸ(0âŠ¸â‰ )Â¨direction
  }  # if maxParam < 0, ray is intersecting AABB, but the whole AABB is behind us # if minParam > maxParam, ray doesn't intersect AABB
}
# maxParam>0âŒˆminParam
# (x>0)âˆ§y<x
CheckCollisionRay2dCircle â† {directionğ•ŠâŸ¨centerâ‹„radiusâŸ©: # v2 v2 f
  dot â† 0âŒˆ+Â´directionÃ—center
  n â† (+Â´âŒ¾(Ã—Ëœ)center-directionÃ—dot)
  {n<radius?
    directionÃ—0âŒˆdot-radius-âŒ¾(Ã—Ëœ)n
  ;
    âˆÃ—0âŠ¸=âŠ¸+direction
  }
}
{ğ•¤
  box â† [100â€¿100
         300â€¿150]
  origin    â† 450â€¿300
  direction â† 0â€¿Â¯1
  center    â† 600â€¿200
  radius    â† 50
  intersect â† âˆâ€¿âˆ
  colors    â† color.grayâ€¿color.red
  walkSpeed â† 3
  turnSpeed â† 3

  # Main game loop
  Rotate â† (â‹ˆâŸœ-Â´â‰âŒ½)â€¢math.Cosâˆ¾â€¢math.Sin
  {ğ•¤
    angleDelta â† turnSpeedÃ—rf.GetFrameTimeâˆ˜âŸ¨âŸ©âŠ¸Ã—-Â´key.IsDown key.rightâ€¿key.left
    direction rm.MPËœâ†© Rotate angleDelta
    origin +â†© walkSpeedÃ—-Ëkey.IsDown ["DS","AW"]
    touchedRecâ€¿touchedCir â† {
      intersect â†© origin+âŒŠËË˜âŒ¾((0âŠ¸=âŠ¸+Ã—direction)âŠ¸Ã—)ğ•©
      âˆ§Ëâˆâ‰ |ğ•©
    } â‰[
      direction RayIntersectRect -âŸœoriginË˜box
      direction CheckCollisionRay2dCircleâŸ¨center-origin, radiusâŸ©
    ]
    box rl.draw.RectangleËœ touchedRecâŠ‘colors
    rf.DrawCircleVâŸ¨centerâ‹„radiusâ‹„touchedCirâŠ‘colorsâŸ©
    rf.DrawCircleV originâ€¿10â€¿color.yellow
    rf.DrawCircleV intersectâ€¿5â€¿color.green
    color.blue rl.draw.Line +`originâ‰directionÃ—500
  } draw._withCanvas_ color.black â€¢_while_ (Â¬rl.window.ShouldClose)@
} rl.window._openAs "raylib extras [Math2d] example - ray rect intersection"