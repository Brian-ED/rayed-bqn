# translated from https://github.com/raylib-extras/examples-c/blob/main/ray2d_rect_intersection/ray2d_rect_intersection.c

âŸ¨color
 draw
 key
 rfâ‡raylib
 rmâ‡raymath
âŸ©â†rlâ†â€¢Import "../../rayed.bqn"

# intersection using the slab method
# https://tavianator.com/2011/ray_box.html#:~:text=The%20fastest%20method%20for%20performing,remains%2C%20it%20intersected%20the%20box.
RayIntersectRect â† {directionð•Šbox: # v2ð•Š[v2,v2] â†’ v2
  ð•¨Ã—âŸ(0âŠ¸â‰ )Â¨ËœâˆžâŸ(âˆ¨Â´â‰¤)âŸœ(0âŒˆâŒˆÂ´)ËœËâ‰âˆ§Ë˜ð•¨Ã·Ëœâ‰ð•©
}
# maxParam>0âŒˆminParam
# (x>0)âˆ§y<x
CheckCollisionRay2dCircle â† {directionð•Šcenterâ€¿radius: câ€¿râ†ð•© # v2 ð•Š v2â€¿f
  ð•¨Ã—âŸ(0âŠ¸â‰ )Â¨Ëœ-0âŒŠ(0âŠ¸<â—¶Â¯âˆžâ€¿âˆšrÃ—ËœâŠ¸-Â·+Â´âˆ˜Ã—Ëœc-ð•¨Ã—âŠ¢)âŒ¾((0âŒˆ+Â´ð•¨Ã—c)âŠ¸+)0
}
{ð•¤
  box â† [100â€¿100
         300â€¿150]
  origin    â† 450â€¿300
  direction â† 0â€¿Â¯1
  center    â† 600â€¿200
  radius    â† 50
  colors    â† color.grayâ€¿color.red
  walkSpeed â† 3
  turnSpeed â† 3

  Rotate â† (â‹ˆâŸœ-Â´â‰âŒ½)â€¢math.Cosâˆ¾â€¢math.Sin

  # Main game loop
  {ð•¤
    angleDelta â† turnSpeedÃ—rf.GetFrameTimeâˆ˜âŸ¨âŸ©âŠ¸Ã—-Â´key.IsDown key.rightâ€¿key.left
    direction rm.MPËœâ†© Rotate angleDelta
    origin +â†© walkSpeedÃ—-Ëkey.IsDown ["DS","AW"]
    interaction â† â‰[
      direction RayIntersectRect -âŸœoriginË˜box
      direction CheckCollisionRay2dCircleâŸ¨center-origin, radiusâŸ©
    ]
    touchedRecâ€¿touchedCir â† âˆ§Ëâˆžâ‰ |interaction
    intersect â† origin+âŒŠËË˜âŒ¾((0âŠ¸=âŠ¸+direction)âŠ¸Ã—)interaction

    box rl.draw.RectangleËœ touchedRecâŠ‘colors
    rf.DrawCircleVâŸ¨centerâ‹„radiusâ‹„touchedCirâŠ‘colorsâŸ©
    rf.DrawCircleV originâ€¿10â€¿color.yellow
    rf.DrawCircleV intersectâ€¿5â€¿color.green
    color.blue rl.draw.Line +`originâ‰directionÃ—500
  }draw._withCanvasâŸœcolor.black â€¢_while_ (Â¬rl.window.ShouldClose)@
} rl.window._openAs "raylib extras [Math2d] example - ray rect intersection"