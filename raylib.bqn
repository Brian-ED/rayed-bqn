## Conventions:
# if position is an argument, it's always ğ•©.
# if color is an argument, it's always ğ•—.
# if function has no intended output, output ğ•©, it makes chaining look nicer.

rayFFI â‡ â€¢Import "rayffi.bqn"

IsInt â† {ğ•©âŠ£(âŒˆâŸœ=ğ•©)!Ëœ" has to be int"âˆ¾Ëœğ•¨âŠ£"ğ•©"}

_bitwise â‡ {
  _into â† {ğ•—_ğ•£â¼ğ•©: ğ•—âŠ¸Ã—âŠ¸+ËœÂ´ğ•©; ğ•—|âŒŠâˆ˜Ã·âŸœğ•—âŸ(â†•1+Â·âŒŠğ•—â‹†â¼1âŒˆâŠ¢)ğ•©}
  ğ•—{_ğ•£:(ğ”½Â´âŒˆâ—‹â‰ â†‘Â¨â‹ˆ)âŒ¾(2 _into)}
}

IsKeyPressed â‡ {ğ•Š key:
  0â‰ rayFFI.IsKeyPressed-âŸœ@âŸ(âˆâŠ¸<)ğ•©
}âš‡0

image â‡ {
  Load   â‡ {ğ•ŠstrPath   : âŠ‘rayFFI.LoadImageğ•©âˆ¾@} # âŠ‘ is used because LoadImage outputs imageâ€¿strPath for unknown reasons.
  Unload â‡ {ğ•Šimage     : @âŠ£rayFFI.UnloadImageğ•©}
  _with  â‡ {ğ”½_ğ•£ strPath: Unload ğ”½ Loadğ•©}
}
texture â‡ {
  Load   â‡ {ğ•ŠstrPath:   rayFFI.LoadTextureğ•©âˆ¾@} # Load texture from file into GPU memory (VRAM)
  Unload â‡ {ğ•Štexture: @âŠ£rayFFI.UnloadImageğ•©}
  _with  â‡ {ğ”½_ğ•£ strPath: (UnloadâŠ¢ğ”½) Loadğ•©}
  
  # TODO: texture.Draw    r.rayFFI.DrawTextureEx textureâ€¿posâ€¿rotationâ€¿scaleâ€¿color
}

mouse â‡ {
  GetPos     â‡rayFFI.GetMousePositionâˆ˜âŸ¨âŸ©
  WheelMoved â‡rayFFI.GetMouseWheelMoveâˆ˜âŸ¨âŸ©
}

window â‡ {
  âŸ¨_openAs_ â‹„ ShouldClose   â‹„ isOpen
   SetIcon â‹„ SetBackground â‹„ Setting
   fpsâŸ©â‡
  isOpen â† 0
  Open â† {scale ğ•Š title: 
    (Â¬isOpen)!Ëœ"The window cannot be opened twice"
    (ğ•¨â‰¡0âŒˆ1âŒŠğ•¨)!Ëœ"Scale can only be between 0 and 1"
    ((âŸ¨âŸ©âŠ¸â‰¡âˆ¨âŸ¨2âŸ©âŠ¸â‰¡)â‰¢ğ•¨)!Ëœ"Scale can be a scaler (âŸ¨âŸ©â‰¢â‰¢ğ•¨) or length two list (âŸ¨2âŸ©â‰¡â‰¢ğ•¨)"
    rayFFI.InitWindow 0â€¿0âˆ¾<ğ•©âˆ¾@
    rayFFI.SetWindowPosition 0â€¿42 # 42 here is the window header size
    rayFFI.SetWindowSize ğ•¨Ã—(rayFFI.GetMonitorWidth âˆ¾ rayFFI.GetMonitorHeight) rayFFI.GetCurrentMonitorâŸ¨âŸ©
    rayFFI.SetTargetFPS 60
    ğ•©âŠ£isOpenâ†©1
  }

  ShouldClose â† 0â‰ rayFFI.WindowShouldCloseâˆ˜âŸ¨âŸ©
  Close â† {
    "No window is open"!isOpen
    rayFFI.CloseWindowâŸ¨âŸ©
    ğ•©âŠ£isOpenâ†©0
  }
  _openAs_ â† {
    ğ•© Open ğ•˜ 
    rayFFI.SetWindowState 4
    Close ğ”½@
  }
  SetBackground â† {ğ•Šrâ€¿gâ€¿bâ€¿t:
    (âˆ§Â´ğ•©âˆŠâ†•256)!Ëœ"ClearBackground only accepts ints in the range 0-255 inclusive"
    rayFFI.ClearBackground ğ•©
  }
  # TODO: Needs to test input for image
  SetIcon â† {ğ•Šimage:rayFFI.SetWindowIconğ•©}

  # TODO: Make this modify window settings instead of overwrite it
  Setting â† {
    "fps":    rayFFI.GetFPSâŸ¨âŸ©
   ;"resize": rayFFI.IsWindowState 4
  }âŠ˜{
     0ğ•Š"resize": rayFFI.SetWindowState 0;
     1ğ•Š"resize": rayFFI.SetWindowState 4;
     ğ•¨ğ•Š"fps":
      "ğ•¨ has to be int"!âŒˆâŠ¸â‰¡ğ•¨
      rayFFI.SetTargetFPS ğ•¨
  }"Window has to be open to access settings"!isOpenË™
  fpsâ‡{
    Get â‡ rayFFI.GetFPSâˆ˜âŸ¨âŸ©
    Set â‡ {
      (ğ•©=âŒˆ0âŒˆğ•©)!Ëœ"FPS has to be a positive int"
      ğ•©âŠ£rayFFI.SetTargetFPSğ•©
    }
  }
}

draw â‡ {
  âŸ¨Start   â‹„ End        â‹„ _withCanvas_
   _Circle â‹„ _Rectangle â‹„ _Text_
  âŸ©â‡

# Needs rethinking on design. I won't add this till i've redesigned some stuff.
#  _Texture_ â† {degree âŸ¨r,g,b,tâŸ©_ğ•£_ texture pos: # missing rotation and scale
#    rayFFI.DrawTextureEx ğ•˜â€¿ğ•©â€¿ğ•¨â€¿0.25â€¿color.whiteâ€¿90 # texture position rotation scale tint    
#  }

  Start â† rayFFI.BeginDrawingâˆ˜âŸ¨âŸ©
  End   â† rayFFI.EndDrawing  âˆ˜âŸ¨âŸ©
  _withCanvas_ â† {
    Start@
    window.SetBackgroundğ•˜
    âŠ£âŸœEndğ”½ğ•©
  }
  _Circle â† {radius âŸ¨r,g,b,tâŸ©_ğ•£ posXâ€¿posY :
    "only accepts ints as args"    !âˆ§Â´âŒŠâŠ¸=aâ†ğ•©âˆ¾ğ•¨âˆ¾ğ•—
    "Incorrect amount of arguments"!7=â‰ a
    rayFFI.DrawCircle âŒŠğ•©âˆ¾ğ•¨â€¿ğ•—
  }
  _Rectangle â† {widthâ€¿height âŸ¨r,g,b,tâŸ©_ğ•£ posXâ€¿posY :
    "Rectangle only accepts ints as args"!âˆ§Â´âŒˆâŠ¸=ğ•©âˆ¾ğ•¨âˆ¾ğ•—
    rayFFI.DrawRectangleâŒŠ(ğ•©âˆ¾ğ•¨)âˆ¾<ğ•—
  }
  _Text_ â† {text âŸ¨r,g,b,tâŸ©_ğ•£_ fontSize âŸ¨posX,posYâŸ©:
    rayFFI.DrawText (ğ•¨âˆ¾@)<âŠ¸âˆ¾âŒŠğ•©âˆ¾ğ•˜â€¿ğ•—
  }
}

color â‡ {
  hex â‡ {
    From â‡ 16âŠ¸Ã—âŠ¸+ËœÂ´âˆ˜âŒ½Ë˜Â·(âˆ¾"0A"+âŸœâ†•Â¨10â€¿6)âŠ¸âŠË˜âˆ˜â€¿2â¥ŠâŠ¢
  }

  whiteâ‡4â¥Š255 â‹„ blackâ‡Â¯4â†‘255
  [red â€¿green  â€¿blue
   cyanâ€¿magentaâ€¿yellow]â‡255Ã—1âˆ¾ËœÂ¨â‰(-â†•3)âŒ½âŒœâ‹ˆâŸœÂ¬3â†‘1
}

key â‡ {
  # consider switching to `letter-@` when possible.

  # vars           Keycodes   Keys
  kNULL          â‡ 0        # NULL, used for no key pressed
  # Alphanumeric keys
  kAPOSTROPHE    â‡ 39       # '
  kCOMMA         â‡ 44       # ,
  kMINUS         â‡ 45       # -
  kPERIOD        â‡ 46       # .
  kSLASH         â‡ 47       # /
  kZERO          â‡ 48       # 0
  kONE           â‡ 49       # 1
  kTWO           â‡ 50       # 2
  kTHREE         â‡ 51       # 3
  kFOUR          â‡ 52       # 4
  kFIVE          â‡ 53       # 5
  kSIX           â‡ 54       # 6
  kSEVEN         â‡ 55       # 7
  kEIGHT         â‡ 56       # 8
  kNINE          â‡ 57       # 9
  kSEMICOLON     â‡ 59       # ;
  kEQUAL         â‡ 61       # =
  kA             â‡ 65       # A | a
  kB             â‡ 66       # B | b
  kC             â‡ 67       # C | c
  kD             â‡ 68       # D | d
  kE             â‡ 69       # E | e
  kF             â‡ 70       # F | f
  kG             â‡ 71       # G | g
  kH             â‡ 72       # H | h
  kI             â‡ 73       # I | i
  kJ             â‡ 74       # J | j
  kK             â‡ 75       # K | k
  kL             â‡ 76       # L | l
  kM             â‡ 77       # M | m
  kN             â‡ 78       # N | n
  kO             â‡ 79       # O | o
  kP             â‡ 80       # P | p
  kQ             â‡ 81       # Q | q
  kR             â‡ 82       # R | r
  kS             â‡ 83       # S | s
  kT             â‡ 84       # T | t
  kU             â‡ 85       # U | u
  kV             â‡ 86       # V | v
  kW             â‡ 87       # W | w
  kX             â‡ 88       # X | x
  kY             â‡ 89       # Y | y
  kZ             â‡ 90       # Z | z
  kLEFT_BRACKET  â‡ 91       # [
  kBACKSLASH     â‡ 92       # '\'
  kRIGHT_BRACKET â‡ 93       # ]
  kGRAVE         â‡ 96       # `
  # Function keys
  kSPACE         â‡ 32       # Space
  kESCAPE        â‡ 256      # Esc
  kENTER         â‡ 257      # Enter
  kTAB           â‡ 258      # Tab
  kBACKSPACE     â‡ 259      # Backspace
  kINSERT        â‡ 260      # Ins
  kDELETE        â‡ 261      # Del
  kRIGHT         â‡ 262      # Cursor right
  kLEFT          â‡ 263      # Cursor left
  kDOWN          â‡ 264      # Cursor down
  kUP            â‡ 265      # Cursor up
  kPAGE_UP       â‡ 266      # Page up
  kPAGE_DOWN     â‡ 267      # Page down
  kHOME          â‡ 268      # Home
  kEND           â‡ 269      # End
  kCAPS_LOCK     â‡ 280      # Caps lock
  kSCROLL_LOCK   â‡ 281      # Scroll down
  kNUM_LOCK      â‡ 282      # Num lock
  kPRINT_SCREEN  â‡ 283      # Print screen
  kPAUSE         â‡ 284      # Pause
  kF1            â‡ 290      # F1
  kF2            â‡ 291      # F2
  kF3            â‡ 292      # F3
  kF4            â‡ 293      # F4
  kF5            â‡ 294      # F5
  kF6            â‡ 295      # F6
  kF7            â‡ 296      # F7
  kF8            â‡ 297      # F8
  kF9            â‡ 298      # F9
  kF10           â‡ 299      # F10
  kF11           â‡ 300      # F11
  kF12           â‡ 301      # F12
  kLEFT_SHIFT    â‡ 340      # Shift left
  kLEFT_CONTROL  â‡ 341      # Control left
  kLEFT_ALT      â‡ 342      # Alt left
  kLEFT_SUPER    â‡ 343      # Super left
  kRIGHT_SHIFT   â‡ 344      # Shift right
  kRIGHT_CONTROL â‡ 345      # Control right
  kRIGHT_ALT     â‡ 346      # Alt right
  kRIGHT_SUPER   â‡ 347      # Super right
  kKB_MENU       â‡ 348      # KB menu
  # Keypad keys
  kKP_0          â‡ 320      # Keypad 0
  kKP_1          â‡ 321      # Keypad 1
  kKP_2          â‡ 322      # Keypad 2
  kKP_3          â‡ 323      # Keypad 3
  kKP_4          â‡ 324      # Keypad 4
  kKP_5          â‡ 325      # Keypad 5
  kKP_6          â‡ 326      # Keypad 6
  kKP_7          â‡ 327      # Keypad 7
  kKP_8          â‡ 328      # Keypad 8
  kKP_9          â‡ 329      # Keypad 9
  kKP_DECIMAL    â‡ 330      # Keypad .
  kKP_DIVIDE     â‡ 331      # Keypad /
  kKP_MULTIPLY   â‡ 332      # Keypad *
  kKP_SUBTRACT   â‡ 333      # Keypad -
  kKP_ADD        â‡ 334      # Keypad +
  kKP_ENTER      â‡ 335      # Keypad Enter
  kKP_EQUAL      â‡ 336      # Keypad =
  kBACK          â‡ 4        # Android back button
  kMENU          â‡ 82       # Android menu button
  kVOLUME_UP     â‡ 24       # Android volume up button
  kVOLUME_DOWN   â‡ 25       # Android volume down button
}