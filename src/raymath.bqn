âŸ¨MPâ‹„MatrixLookAt
 MatrixScaleâ‹„MatrixRotate
 GetCameraMatrix2D
âŸ©â‡

âŸ¨MPâŸ© â† â€¢Import "imports/bqn-libs/matrix.bqn"

# Get camera look-at matrix (view matrix)
# returns Matrix
MatrixLookAt â† {ğ•Šeyeâ€¿targetâ€¿up: # v3 v3 v3
  vz â† {ğ•©Ã·1âŸ(0=âŠ¢)+Â´âŒ¾(â‹†âŸœ2)ğ•©} eye-target
  vx â† {ğ•©Ã·1âŸ(0=âŠ¢)+Â´âŒ¾(â‹†âŸœ2)ğ•©} -Â´Ã—Â´Ë˜1â€¿Â¯1âŒ½âŒœupâ€¿vz
  vy â† -Â´Ã—Â´Ë˜1â€¿Â¯1âŒ½âŒœvzâ€¿vx

  [
    âŸ¨vx.x â‹„ vy.x â‹„ vz.x â‹„ 0âŸ©
    âŸ¨vx.y â‹„ vy.y â‹„ vz.y â‹„ 0âŸ©
    âŸ¨vx.z â‹„ vy.z â‹„ vz.z â‹„ 0âŸ©
    1âˆ¾Ëœ-eyeâŠ¸Ã—Â¨vxâ€¿vyâ€¿vz
  ]
}

# Get translation matrix
MatrixTranslate â† {ğ•Šxâ€¿yâ€¿z:[# v3 â†’ Matrix
  1â€¿0â€¿0â€¿x
  0â€¿1â€¿0â€¿y
  0â€¿0â€¿1â€¿z
  0â€¿0â€¿0â€¿1
]}

# Get scaling matrix
MatrixScale â† {ğ•Šxâ€¿yâ€¿z:(1+4â†‘ğ•©-1)âŒ¾(0â€¿0âŠ¸â‰)4â€¿4â¥Š0}

# Create rotation matrix from axis and angle
# NOTE: Angle should be provided in radians
MatrixRotate â† {ğ•Šaxisâ€¿angle: # v3 f
  xâ€¿yâ€¿z â† (+Â´axisâ‹†2)Ã·âŸœâˆšËœâŸ(âˆ§Â´2â†•âŠ¸â‰ âŠ£)axis

  sinres â† â€¢math.Sin angle
  cosres â† â€¢math.Cos angle
  m â† ((Â¬cosres)Ã—Ã—âŒœËœxâ€¿yâ€¿z)+(cosresÂ¨âŒ¾(0â€¿0âŠ¸â‰)3â€¿3â¥Šsinres)Ã—[
    âŸ¨ 1 â‹„-z â‹„ yâŸ©
    âŸ¨ z â‹„ 1 â‹„-xâŸ©
    âŸ¨-y â‹„ x â‹„ 1âŸ©
  ]
  âˆ¾[mâ€¿âŸ¨0,0,0âŸ©
    âŸ¨0â€¿0â€¿0â‹„1âŸ©]
}


### rcore.c functions

# Get camera 2d transform matrix
GetCameraMatrix2D â† {ğ•Šcamera: # camera2d
  # The camera in world-space is set by
  #   1. Move it to target
  #   2. Rotate by -rotation and scale by (1/zoom)
  #      When setting higher scale, it's more intuitive for the world to become bigger (= camera become smaller),
  #      not for the camera getting bigger, hence the invert. Same deal with rotation.
  #   3. Move it by (-offset);
  #      Offset defines target transform relative to screen, but since we're effectively "moving" screen (camera)
  #      we need to do it into opposite direction (inverse transform)
    
  # Having camera transform in world-space, inverse of it gives the modelview transform.
  # Since (A*B*C)' = C'*B'*A', the modelview is
  #   1. Move to offset
  #   2. Rotate and Scale
  #   3. Move by -target
  origin      â† MatrixTranslate-(1âŠ‘camera)âˆ¾0
  rotation    â† MatrixRotate 0â€¿0â€¿1â‹ˆ Ï€Ã·180Ã—2âŠ‘camera
  scale       â† MatrixScale 1âˆ¾Ëœ2â¥Š3âŠ‘camera
  translation â† MatrixTranslate 0âˆ¾ËœâŠ‘camera
  matTransform â† originâ€¿scaleâ€¿rotation MPÂ´âŠ¸MP translation
}