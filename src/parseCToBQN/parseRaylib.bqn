## Metaprogram rayffi.bqn automatically.
## INCOMPLETE the current rayffi file is all manually made.

ffiUtilsPathâ†âŠ‘â€¢argsâˆ¾<"../ffiUtils.bqn"

nl â† @+10 # newline
json â† â€¢Import "../imports/bqn-libs/json.bqn"

Box â†  >âŠ¢Â»Â¨âŸœ<' 'â¥ŠËœÂ·âŒˆÂ´â‰ Â¨
LowerNames â† +âŸœ(32Ã—1="A["âŠ¸â‹)âŒ¾(1â†‘âŠ¢)
_MetaParse â† {âˆ¾Ë˜Â´BoxÂ¨ğ•¨âˆ¾âŸ(âŸ¨âŸ©â‰¢âŠ¢)âš‡1ğ•—{ğ•ğ•©}Â¨Â¨<Ë˜â‰ğ•©}
âŸ¨raylibPathâŸ© â† â€¢Import"../loadConfig.bqn"

mapArgTypes â† {ğ•Š[bqn,c]:{ğ•©LowerNamesâˆ˜âŠ£âŸ(0âŠ¸â‰¡)Â¨(câŠğ•©)âŠbqnâˆ¾<0}6â†“âŸ("const "â‰¡â†‘)Â¨âŠ¢}â‰[  
  # ? really unsure of:
  "ptr"â€¿"..."
  "'*'âˆ¾str"â€¿"const char **"
  "'*'âˆ¾str"â€¿"char **"
  "ptr"â€¿"const void *"
  "ustr"â€¿"unsigned char *"
  "str"â€¿"char *"
  "'*'âˆ¾camera3D"â€¿"Camera *"
  """**""âˆ¾rectangle"â€¿"Rectangle **"
  "'*'âˆ¾glyphInfo"â€¿"GlyphInfo *"
  "'*'âˆ¾matrix"â€¿"Matrix *"
  "renderTexture"â€¿"RenderTexture2D"

  # pointers
  "'*'âˆ¾wave"â€¿"Wave *"
  "'*'âˆ¾image"â€¿"Image *"
  "'*'âˆ¾model"â€¿"Model *"
  "'*'âˆ¾mesh"â€¿"Mesh *"
  "'*'âˆ¾modelAnimation"â€¿"ModelAnimation *"
  "'*'âˆ¾color"â€¿"Color *"
  "'*'âˆ¾v2"â€¿"Vector2 *"
  "'*'âˆ¾v3"â€¿"Vector3 *"
  "'*'âˆ¾v4"â€¿"Vector4 *"
  "'*'âˆ¾texture"â€¿"Texture2D *"
  "texture"â€¿"Texture2D"
  "'*'âˆ¾material"â€¿"Material *"
  "'*'âˆ¾matrix"â€¿"const Matrix *"
  
  # shorten struct names
  "v4"â€¿"Vector4"
  "v3"â€¿"Vector3"
  "v2"â€¿"Vector2"
  "camera3D"â€¿"Camera"
  "ptr"â€¿"TraceLogCallback"
  "ptr"â€¿"LoadFileDataCallback"
  "ptr"â€¿"SaveFileDataCallback"
  "ptr"â€¿"LoadFileTextCallback"
  "ptr"â€¿"SaveFileTextCallback"
  "ptr"â€¿"AudioCallback"

  "ptr"   â€¿"void *"
  "i"      â€¿"int"
  "u"      â€¿"unsigned int"
  "'*'âˆ¾u"â€¿"unsigned int *"
  """f64"""â€¿"double"
  "'*'âˆ¾i"â€¿"int *"
  "'*'âˆ¾f"â€¿"float *"
  "f"      â€¿"float"
  "str"    â€¿"const char *"
  "uStr"   â€¿"const unsigned char *"
  "u8"â€¿"char"
]

mapStructTypes â† {ğ•Š[bqn,c]:{ğ•©âŠ£âŸ(0âŠ¸â‰¡)Â¨((LowerNamesÂ¨c)âŠğ•©)âŠbqnâˆ¾0}{
  Fâ†ğ”½
  t â† ']'=Â¯1âŠ‘Â¨ğ•©
  b â† (â‰ Â¨ğ•©)-Ëœğ•©âŠ‘âˆ˜âŠÂ¨'['
  "ptr"âŸ('*'=Â¯1âŠ¸âŠ‘)Â¨ b {3â†“ğ•©}âŸ(0=âŠ£)Â¨ {'"'âˆ¾Â¨(bâ†‘Â¨ğ•©)âˆ¾Â¨"""âˆ¾"âŠ¸âˆ¾Â¨F bâ†“Â¨ğ•©} LowerNamesÂ¨ğ•©
}}â‰[  
  # lotsa ptrs since no destructuring pointers in structs (or atleast when returning from functions)
  "ptrâŠ£'*'âˆ¾str"            â€¿"const char **"
  "ptrâŠ£'*'âˆ¾wave"           â€¿"Wave *"
  "ptrâŠ£'*'âˆ¾image"          â€¿"Image *"
  "ptrâŠ£'*'âˆ¾model"          â€¿"Model *"
  "ptrâŠ£'*'âˆ¾mesh"           â€¿"Mesh *"
  "ptrâŠ£'*'âˆ¾modelAnimation" â€¿"ModelAnimation *"
  "ptrâŠ£'*'âˆ¾color"          â€¿"Color *"
  "ptrâŠ£'*'âˆ¾v2"             â€¿"Vector2 *"
  "ptrâŠ£'*'âˆ¾v3"             â€¿"Vector3 *"
  "ptrâŠ£'*'âˆ¾v4"             â€¿"Vector4 *"
  "ptrâŠ£'*'âˆ¾texture"        â€¿"Texture2D *"
  "ptrâŠ£'*'âˆ¾material"       â€¿"Material *"
  "ptrâŠ£'*'âˆ¾matrix"         â€¿"const Matrix *"
  "ptrâŠ£'*'âˆ¾u8"                 â€¿"unsigned char *"
  """u16"""                â€¿"unsigned short *"
  "u8"                     â€¿"unsigned char"
  "u8"                     â€¿"char"
  """i64"""â€¿"long"
  "texture"â€¿"TextureCubemap"
  "renderTexture"â€¿"RenderTexture2D"

  # shorten struct names
  "v4"     â€¿"Vector4"
  "v3"     â€¿"Vector3"
  "v2"     â€¿"Vector2"
  "texture"â€¿"Texture2D"

  "i"          â€¿"int"
  "u"          â€¿"unsigned int"
  "ptrâŠ£'*'âˆ¾u"  â€¿"unsigned int *"
  """f64"""    â€¿"double"
  "ptrâŠ£'*'âˆ¾i"  â€¿"int *"
  "ptrâŠ£'*'âˆ¾f"  â€¿"float *"
  "f"          â€¿"float"
  "ptrâŠ£str"    â€¿"const char *"
  "ptrâŠ£uStr"   â€¿"const unsigned char *"
]
mapFuncNames â† {ğ•Š[bqn,c]:{ğ•©LowerNamesâˆ˜âŠ£âŸ(0âŠ¸â‰¡)Â¨(câŠğ•©)âŠbqnâˆ¾<0}6â†“âŸ("const "â‰¡â†‘)Â¨âŠ¢}â‰[  
  "v4"â€¿"Vector4"
  "v3"â€¿"Vector3"
  "v2"â€¿"Vector2"
]

MapFuncReturnType â† " "âŸ("void"âŠ¸â‰¡)Â·('('âŠ¸âˆ¾âˆ¾âŸœ')')âŸ(âˆ¨Â´"âˆ¾âŠ£"âŠ¸âˆŠ)MapStructTypesâŒ¾<

"./inp-out/rayffi.bqn"â€¢FLines (â€¢FLines "topOfRayffi.bqn") âˆ¾(â‹ˆ"r â‡ MakeImporter """âˆ¾raylibPathâˆ¾'"')âˆ¾ {
 "defines"ğ•Šğ•©:
    Parse â† {âˆ¾Ë˜Â´BoxÂ¨""â€¿""â€¿" â‡ "â€¿" # "âˆ¾âŸ(âŸ¨âŸ©â‰¢âŠ¢)âš‡1âŸ¨LowerNames,âŸ¨âŸ©Ë™,â€¢Repr,âŠ¢âŸ©{ğ•ğ•©}Â¨Â¨ <Ë˜â‰ğ•©}
    exclTypes  â† "GUARD"â€¿"MACRO"â€¿"UNKNOWN"â€¿"FLOAT_MATH"â€¿"COLOR"
    Filter     â† {ğ•Šnâ€¿tâ€¿vâ€¿d: # nameâ€¿typeâ€¿valâ€¿desc
      Â¬âˆ¨Â´âŸ¨"PI"â‰¡n, âˆ¨Â´tâŠ¸â‰¡Â¨exclTypes, âŸ¨âŸ©â‰¡v âŸ©
    }
    â¥Šnlâˆ¾Ë˜Parse FilterË˜âŠ¸/ 1âŠË˜Ë˜ >â‰Â¨ğ•©
;
  "structs"ğ•Šğ•©:
    ParseStruct â† {
      âˆ¾(@+10)âˆ¾Â¨"âŸ©"âˆ¾Ëœ<Ë˜"  "âˆ¾â‰1""â€¿" # "â€¿"  # "âŸ¨âŠ¢, âŠ¢,âŠ¢âŸ©_MetaParse MapStructTypesâŒ¾(âŠË˜) >ğ•©
    }
    Parse â† { # ğ•Š â‰[name,desc,fields]:
      {
        header â† (Â»âŠ¸âˆ¨' 'âŠ¸â‰ )âŠ¸/Â¨<Ë˜âŸ¨@+10âŸ©â€¿" â‡ S âŸ¨ # "âŸ¨LowerNames,âŠ¢âŸ©_MetaParse MapFuncNamesâŒ¾(âŠË˜) 2â†‘Ë˜ğ•©
        body â† âˆ¨`âŒ¾âŒ½âˆ˜â‰ âŸœ' 'âŠ¸/Â¨<Ë˜âŸ¨""âŸ©âŸ¨ParseStruct 1âŠÂ¨âŠ¢âŸ©_MetaParse Â¯1â†‘Ë˜3â†‘Ë˜ğ•©
        âˆ¾ body âˆ¾ËœÂ¨header
      }âŒ½âŒ¾(1â†“âŠ¢)Ë˜âŒ¾â‰ğ•©
    }
    Parse 1âŠË˜Ë˜>â‰Â¨âŒ½ğ•©
;
  "aliases"ğ•Šğ•©:"" # no aliases
;
  "callbacks"ğ•Šğ•©:"" # no callbacks
;
  "enums"ğ•Šğ•©:
    ParseNamespaceâ†{ğ•Šnameâ€¿descriptionâ€¿values:
      header â† (LowerNames name)âˆ¾" â‡ { # "âˆ¾description
      body   â† ""â€¿" â‡ "â€¿"  # "âŸ¨LowerNames,â€¢Repr,âŠ¢âŸ©_MetaParse >1âŠÂ¨values
      (nlâˆ¾"}")âˆ¾Ëœheaderâˆ¾âˆ¾(nlâˆ¾"  ")âŠ¸âˆ¾Â¨<Ë˜body
    }
    âˆ¾nlâˆ¾Â¨ParseNamespaceÂ¨1âŠÂ¨ğ•©
;
  "functions"ğ•Šğ•©:
    FillTitles â† {ğ•Š[titles, args]:
      all â† "name"â€¿"description"â€¿"returnType"â€¿"params"
      argsâŒ¾((/allâˆŠtitles)âŠ¸âŠ)(0â€¿2â¥Š"")âˆ¾âŸœ<Ëœ3â¥Š<""
    }

    â¥Šnlâˆ¾Ë˜âŸ¨"", " â‡ ", "", " _R"," # "âŸ©âŸ¨LowerNamesâ‹„MapFuncReturnTypeâ‹„'"'âˆ¾'"'âˆ¾ËœâŠ¢â‹„âŠ¢â‹„âŠ¢âŸ©_MetaParse{# â‰[name, description, returnType, params]:
      0â€¿1â€¿0â€¿2â€¿3âŠ¸âŠË˜{<Ë˜âˆ¾Ë˜Â´<âˆ˜BoxË˜â‰>{âŸ¨'âŸ¨'âˆ¾'âŸ©'âˆ¾Ëœ1â†“âˆ¾'â‹„'âˆ¾Â¨MapArgTypesâŠ‘ğ•©, "#"âˆ¾âŸœâˆ¾' 'âˆ¾Â¨1âŠ‘ ğ•©âŸ©}Â¨(<Ë˜â‰âˆ˜>)Â¨1âŠÂ¨Â¨ğ•©}âŒ¾(2âŠË˜âŠ¢) 0â€¿2â€¿3â€¿1âŠ¸âŠË˜ğ•©
    }> FillTitlesÂ¨ğ•©
}Â´Â¨<Ë˜â‰json.Parse â€¢FChars "./inp-out/raylib.json"