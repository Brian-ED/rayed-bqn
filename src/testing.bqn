# This file may be turned into a testing directory when it gets bigger.
# Catagories are seperated by 2 newlines.

# testing values
camera2D â† {targetâ‡20â€¿30 â‹„ offsetâ‡40â€¿60 â‹„ zoomâ‡1.2 â‹„ rotationâ‡95}
camera3D â† {positionâ‡230â€¿120â€¿90 â‹„ targetâ‡204â€¿303â€¿226 â‹„ upâ‡0â€¿1â€¿0 â‹„ fovyâ‡100 â‹„ projectionâ‡1}


# Math:
âŸ¨
  MatrixRotate, Wrap, Normalize, Vector3Unproject, MP, _ToDim_, MatrixExtend, Round
  QuaternionEquals, Vector3OrthoNormalize, Vector3RotateByAxisAngle, VectorClampValue
  MatrixTranslate, MatrixRotateX, MatrixRotateY, MatrixRotateZ, VectorAngle, deg2rad, rad2deg
  LineToSlopeIntercept, DistanceToPlane, QuaternionFromEuler, QuaternionToEuler
  VectorReflect, VectorNormalize, Vector3CrossProduct, Vector2LineAngle, Remap

  # These have been extensively tested against C versions
  MatrixOrtho
  MatrixLookAt,
âŸ© â† â€¢Import "math.bqn"

Approx â† 5âŠ¸Round

â€¢Out "(math tests started"
eâ†"Round"
e!100.2131â‰¡4 Round 100.21312344123

eâ†©"MatrixRotate"
e!(Approx MatrixRotate 0 â€¿0â€¿1â‹ˆÂ¯21) â‰¡ 3â€¿3â¥ŠÂ¯0.54773â€¿0.83666â€¿0â€¿Â¯0.83666â€¿Â¯0.54773â€¿0â€¿0â€¿0â€¿1
e!(Approx MatrixRotate 0 â€¿1â€¿0â‹ˆ 45) â‰¡ 3â€¿3â¥Š0.52532â€¿0â€¿0.8509â€¿0â€¿1â€¿0â€¿Â¯0.8509â€¿0â€¿0.52532
e!(Approx MatrixRotate 21â€¿3â€¿4â‹ˆ 45) â‰¡ 3â€¿3â¥Š0.97453â€¿Â¯3.33944â€¿2.63827â€¿3.46779â€¿0.53449â€¿Â¯17.85675â€¿Â¯2.46715â€¿17.8812â€¿0.54162

eâ†©"Wrap"
e!31 â‰¡ Wrap 210â€¿21â€¿200

eâ†©"Normalize"
e!0.5â‰¡0â€¿2 Normalize 1

eâ†©"Vector3Unproject"
mat â† [
  1â€¿2â€¿3â€¿4
  5â€¿6â€¿7â€¿8
  9â€¿1â€¿2â€¿3
  4â€¿5â€¿6â€¿9
]
mat2 â† [
  11â€¿12â€¿13â€¿14
  15â€¿16â€¿17â€¿18
  19â€¿11â€¿12â€¿13
  14â€¿15â€¿16â€¿19
]
s â† 1â€¿2â€¿3
e!(Approx Vector3Unproject sâ€¿matâ€¿mat2) â‰¡ 0.49573â€¿Â¯23.22222â€¿20.03419

eâ†©"MatrixRotateZ"
xâ†[
  1â€¿0â€¿0â€¿2
  0â€¿1â€¿0â€¿2
  0â€¿0â€¿1â€¿2
  0â€¿0â€¿0â€¿1
]
y â† MatrixRotateZ Ï€
c â† x MP _ToDim_ 4 y
e!(Approx c) â‰¡ (4â€¿4â¥ŠÂ¯1â€¿0â€¿0â€¿2â€¿0â€¿Â¯1â€¿0â€¿2â€¿0â€¿0â€¿1â€¿2â€¿0â€¿0â€¿0â€¿1)

eâ†©"MatrixExtend"
e!(3 MatrixExtend 2â€¿2â¥Šâ†•4) â‰¡ (3â€¿3â¥Š0â€¿1â€¿0â€¿2â€¿3â€¿0â€¿0â€¿0â€¿1)
e![1â€¿1â€¿0â‹„1â€¿1â€¿0â‹„1â€¿1â€¿1]â‰¡3 MatrixExtend [1â€¿1â‹„1â€¿1â‹„1â€¿1]

eâ†©"Vector3OrthoNormalize"
e!(Approx 1â€¿2â€¿3 Vector3OrthoNormalize 4â€¿5â€¿6) â‰¡ 0.87287â€¿0.21822â€¿Â¯0.43644
e!((-5+â†•4) QuaternionEquals 5+â†•4)â‰¡1
e!((-4+â†•4) QuaternionEquals 5+â†•4)â‰¡0

eâ†©"Vector3RotateByAxisAngle"
e!(Approx âŸ¨0â€¿1â€¿0, 1âŸ© Vector3RotateByAxisAngle â†•3) â‰¡ 1.68294â€¿1â€¿1.0806
e!(Approx âŸ¨ 0â€¿1â€¿0 â‹„ Â¯0.021 âŸ©Vector3RotateByAxisAngle Â¯2.6848â€¿1.7908â€¿Â¯2.3633) â‰¡ Â¯2.63458â€¿1.7908â€¿Â¯2.41916

eâ†©"VectorClampValue"
e!(+Â´âŒ¾(Ã—Ëœ)âŠ¸â‹ˆ VectorClampValue âŸ¨2â€¿2â€¿2â€¿2,10,22âŸ©) â‰¡ âŸ¨10,5â€¿5â€¿5â€¿5âŸ©
e!(+Â´âŒ¾(Ã—Ëœ)âŠ¸â‹ˆ VectorClampValue âŸ¨2â€¿2â€¿2â€¿2,30,42âŸ©) â‰¡ âŸ¨30,15â€¿15â€¿15â€¿15âŸ©
e!(+Â´âŒ¾(Ã—Ëœ)âŠ¸â‹ˆ VectorClampValue âŸ¨2â€¿2â€¿2â€¿2,0.5,1.5âŸ©) â‰¡ âŸ¨1.5,0.75â€¿0.75â€¿0.75â€¿0.75âŸ©

eâ†©"MatrixRotateX"
e!(Approx âˆ¾MatrixRotateXÂ¨ (Ï€Ã·2)Ã—â†•4) â‰¡ (12â€¿3â¥Š1â€¿0â€¿0â€¿0â€¿1â€¿0â€¿0â€¿0â€¿1â€¿1â€¿0â€¿0â€¿0â€¿0â€¿1â€¿0â€¿Â¯1â€¿0â€¿1â€¿0â€¿0â€¿0â€¿Â¯1â€¿0â€¿0â€¿0â€¿Â¯1â€¿1â€¿0â€¿0â€¿0â€¿0â€¿Â¯1â€¿0â€¿1â€¿0)

eâ†©"MatrixRotateY"
e!(Approx âˆ¾MatrixRotateYÂ¨ (Ï€Ã·2)Ã—â†•4) â‰¡ (12â€¿3â¥Š1â€¿0â€¿0â€¿0â€¿1â€¿0â€¿0â€¿0â€¿1â€¿0â€¿0â€¿Â¯1â€¿0â€¿1â€¿0â€¿1â€¿0â€¿0â€¿Â¯1â€¿0â€¿0â€¿0â€¿1â€¿0â€¿0â€¿0â€¿Â¯1â€¿0â€¿0â€¿1â€¿0â€¿1â€¿0â€¿Â¯1â€¿0â€¿0)

eâ†©"MatrixRotateZ"
e!(Approx âˆ¾MatrixRotateZÂ¨ (Ï€Ã·2)Ã—â†•4) â‰¡ (12â€¿3â¥Š1â€¿0â€¿0â€¿0â€¿1â€¿0â€¿0â€¿0â€¿1â€¿0â€¿1â€¿0â€¿Â¯1â€¿0â€¿0â€¿0â€¿0â€¿1â€¿Â¯1â€¿0â€¿0â€¿0â€¿Â¯1â€¿0â€¿0â€¿0â€¿1â€¿0â€¿Â¯1â€¿0â€¿1â€¿0â€¿0â€¿0â€¿0â€¿1)

eâ†©"MatrixRotateZ AND MatrixTranslate"
mat â†© (MatrixRotateZ Ï€)MP _ToDim_ 4 MatrixTranslate 2â€¿2â€¿2
e!(Approx matâŠ¸MPâŒ¾(âˆ¾âŸœ1)1â€¿2â€¿3) â‰¡ Â¯3â€¿Â¯4â€¿5

eâ†©"VectorAngle"
e!(Approx 1â€¿2     VectorAngle 3â€¿4    ) â‰¡ 0.17985
e!(Approx 1â€¿2â€¿3â€¿4 VectorAngle 5â€¿6â€¿7â€¿8) â‰¡ 0.2502
e!(Approx 1â€¿2â€¿3   VectorAngle 2â€¿3â€¿4  ) â‰¡ 0.12187
e!(Approx[
  1â€¿1â€¿0
  1â€¿3â€¿0
] VectorAngleâ—‹â‰ â‰Ëœ0â€¿1â€¿0) â‰¡ 0.7854â€¿0.32175

eâ†©"LineToSlopeIntercept"
e!(LineToSlopeInterceptâ¼ 1â€¿2         ) â‰¡ Â¯1â€¿1â€¿2
e!(LineToSlopeIntercept 0.5â€¿Â¯0.5â€¿Â¯1) â‰¡ 1â€¿2
e!(LineToSlopeIntercept Â¯1â€¿1â€¿2     ) â‰¡ 1â€¿2

eâ†©"DistanceToPlane"
e!2.71058â‰¡Approx 5â€¿8â€¿2â€¿Â¯2 DistanceToPlane 4â€¿Â¯4â€¿3
e!0.46829â‰¡Approx Â¯5â€¿Â¯8â€¿1â€¿7 DistanceToPlane 2â€¿5â€¿3
e!5.50598â‰¡Approx Â¯3â€¿3â€¿3â€¿1 DistanceToPlane 2â€¿Â¯8â€¿Â¯3
e!4.91935â‰¡Approx 0.5â€¿Â¯0.5â€¿Â¯1 DistanceToPlane 4â€¿4
e!4.91935â‰¡Approx (LineToSlopeInterceptâ¼ 1â€¿2) DistanceToPlane 4â€¿4

e!2.71058â€¿0.46829â€¿4.91935â€¿5.50598â€¿4.91935â‰¡Approx [
   5â€¿Â¯5â€¿ 0.5â€¿Â¯3â€¿Â¯1
   8â€¿Â¯8â€¿Â¯0.5â€¿ 3â€¿1
   2â€¿ 1â€¿Â¯1  â€¿ 3â€¿2
  Â¯2â€¿ 7â€¿ 0  â€¿ 1â€¿0
] DistanceToPlane [
   4â€¿2â€¿4â€¿ 2â€¿4
  Â¯4â€¿5â€¿4â€¿Â¯8â€¿4
   3â€¿3â€¿0â€¿Â¯3â€¿0
]

eâ†©"MatrixLookAt"
e!(Approx MatrixLookAt camera3D.positionâ€¿camera3D.targetâ€¿camera3D.up) â‰¡ 4â€¿4â¥ŠÂ¯0.98221â€¿0.14974â€¿0.1133â€¿0â€¿0â€¿0.60338â€¿Â¯0.79746â€¿0â€¿Â¯0.18778â€¿Â¯0.78327â€¿Â¯0.59264â€¿0â€¿242.80856â€¿Â¯36.35183â€¿122.97376â€¿1

eâ†©"QuaternionFromEuler"
e!(Approx QuaternionFromEuler 1|Ï€â€¿0â€¿Ï€) â‰¡ 0.07056â€¿0.005â€¿0.07056â€¿0.995

eâ†©"QuaternionToEuler"
e!(Approx QuaternionToEuler 0.07056â€¿0.005â€¿0.07056â€¿0.995) â‰¡ 0.14159â€¿1eÂ¯5â€¿0.14159

eâ†©"VectorReflect"
e!(Approx          1â€¿0â€¿0 VectorReflect 2â€¿2â€¿0) â‰¡ Â¯2â€¿2â€¿0
e!(Approx (+Â´âŒ¾(Ã—Ëœ)1â€¿1â€¿0) VectorReflect 0â€¿2â€¿0) â‰¡ Â¯8â€¿Â¯6â€¿Â¯8

eâ†©"VectorNormalize"
e!(VectorNormalize 0â€¿1â€¿1)â‰¡â—‹Approx +Ëœâ¼âˆš0â€¿2â€¿2
e!(VectorNormalize 1â€¿0â€¿1)â‰¡â—‹Approx +Ëœâ¼âˆš2â€¿0â€¿2

e! 0.8â€¿0.6 â‰¡ Approx VectorNormalize 4â€¿3

vnormOut â† [
  [
    0.52981â€¿0.79472â€¿0.13245â€¿0.26491
    0.25355â€¿0.59161â€¿0.08452â€¿0.76064
    0.73241â€¿0.24414â€¿0.48827â€¿0.40689
  ]
  [
    0.31822â€¿0.47733â€¿0.39778â€¿  0.716
    0.05641â€¿0.05641â€¿ 0.0188â€¿0.99664
    0.10038â€¿0.99263â€¿0.06692â€¿0.01115
  ]
]
e!vnormOut â‰¡â—‹Approx VectorNormalizeË˜Ë˜ vnormInp â† [[4â€¿6â€¿1â€¿2â‹„3â€¿7â€¿1â€¿9â‹„9â€¿3â€¿6â€¿5]â‹„[4â€¿6â€¿5â€¿9â‹„3â€¿3â€¿1â€¿53â‹„9â€¿89â€¿6â€¿1]]

e!(VectorNormalize vnormInp) â‰¡â—‹Approx [
  [
    0.70711â€¿0.70711â€¿0.19612â€¿0.21693
    0.70711â€¿0.91915â€¿0.70711â€¿0.16741
    0.70711â€¿0.03369â€¿0.70711â€¿0.98058
  ]
  [
    0.70711â€¿0.70711â€¿0.98058â€¿0.97619
    0.70711â€¿0.39392â€¿0.70711â€¿0.98589
    0.70711â€¿0.99943â€¿0.70711â€¿0.19612
  ]
]

e!(VectorNormalize [1â€¿3â€¿5â‹„2â€¿4â€¿6]) â‰¡â—‹Approx [0.44721â€¿0.6â€¿0.64018â‹„0.89443â€¿0.8â€¿0.76822]
e!(VectorNormalizeË˜[1â€¿2â‹„3â€¿4â‹„5â€¿6]) â‰¡â—‹Approx [0.44721â€¿0.89443â‹„0.6â€¿0.8â‹„0.64018â€¿0.76822]

eâ†©"Vector3CrossProduct"
e!0.70711â€¿Â¯1.06066â€¿1.06066 â‰¡â—‹Approx 1âŠ¸+âŒ¾((VectorNormalize 0â€¿1â€¿1)âŠ¸Vector3CrossProduct) VectorNormalize 1â€¿0â€¿1

eâ†©"Vector2LineAngle"
e!0.88732 â‰¡â—‹Approx 4â€¿100 Vector2LineAngleâ—‹(Ã·âŸœ(0âŠ¸=âŠ¸++Â´âŒ¾(Ã—Ëœ))) 4â€¿3
e!0.88766â€¿0.87731 â‰¡â—‹Approx [4â€¿100â‹„5â€¿100] Vector2LineAngleâ—‹(Ã·âŸœ(0âŠ¸=âŠ¸++ËâŒ¾(Ã—Ëœ)))â—‹â‰ â‰Ëœ4â€¿3

eâ†©"Remap"
e! 68 â‰¡ Remap 12â€¿ 5â€¿10â€¿40â€¿60
e! 40 â‰¡ Remap 10â€¿10â€¿20â€¿40â€¿60


â€¢Out "Math tests passed)"
â€¢Out "(RCore tests started"


âŸ¨GetWorldToScreenExâŸ© â† âŸ¨{â‡}â‹„1âŸ© â€¢Import "rcore.bqn"

pos â† 111â€¿9â€¿4
widthâ€¿height â† 1920â€¿1080

eâ†©"GetWorldToScreenEx"
e!(Approx GetWorldToScreenEx posâ€¿camera3Dâ€¿widthâ€¿height) â‰¡ 2396.74492â€¿728.27699


â€¢Out "RCore tests passed)"
â€¢Out "(Camera tests started"

{ğ•Špositionâ€¿targetâ€¿upâ€¿fovyâ€¿projection:

  positionâ€¿targetâ€¿upâ€¿fovyâ€¿projection
} camera3d

âŸ¨
  Rotate, RotateLocked
  RotateAroundTarget, RotateAroundTargetLocked
  Roll, Pitch, Yaw
âŸ© â† âŸ¨
  {upâ€¿leftâ€¿downâ€¿rightâ€¿wâ€¿aâ€¿sâ€¿dâ€¿eâ€¿qâ€¿spaceâ€¿leftControlâ€¿ispressedâ€¿keypadâ€¿isdownâ€¿leftShiftâ‡â†•16}
  {buttonâ‡{middleâ‡â†•1}}, {getFrameTimeâ€¿gamepadaxisâ€¿getgamepadaxismovementâ€¿isgamepadavailableâ€¿getMouseDeltaâ‡â†•5}
  â€¢Import "math.bqn"
âŸ© â€¢Import "camera.bqn"

# Reference implementation to test against
Rotate2 â† {âŸ¨angleYawâ€¿anglePitchâ€¿angleRollâ‹„lockedâŸ©ğ•Špositionâ€¿targetâ€¿upâ€¿fovyâ€¿projection:
  angleRoll Roll anglePitchâ€¿lockedâ€¿1 Pitch angleYaw Yaw positionâ€¿targetâ€¿upâ€¿fovyâ€¿projection
}

aâ†âŸ¨0.5â€¿0.2â€¿0.4â‹„0âŸ© Rotate2 camera3D
eâ†©"Rotate"
e!aâ‰¡â—‹Approx 0.5â€¿0.2â€¿0.4 Rotate camera3D

câ†©âŸ¨0.5â€¿4â€¿0.4â‹„1âŸ© Rotate2 camera3D
eâ†©"RotateLocked"
e!câ‰¡â—‹Approx 0.5â€¿4â€¿0.4 RotateLocked camera3D

â€¢Out "Camera tests passed)"
