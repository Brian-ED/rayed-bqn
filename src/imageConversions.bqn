âŸ¨
  LoadDataNormalized
  FormatToLengths
  ReFormat
âŸ©â‡
# Encode image data in arrays by using encode to encode into binary data by an input format,
# along with also acounting for luminocity.

# TODOs
# remember to normalize not only by gray but by all colors, depending on their bytes 
# after aproximating, turn leftover data into other colors to keep brightness the same 
# calculate leftovers (that come from shortening bit-lengths and therefore loosing information and brightness) and add them in other colors

# pixel formats for images suported:
# (kinda means it's supported but not space efficient)
# yes    : uncompressed_grayscale    â‡ 1   # 8 bit per pixel (no alpha)   
# yes    : uncompressed_gray_alpha   â‡ 2   # 8*2 bpp (2 channels)         
# kinda  : uncompressed_r5g6b5       â‡ 3   # 16 bpp                       
# yes    : uncompressed_r8g8b8       â‡ 4   # 24 bpp                       
# kinda  : uncompressed_r5g5b5a1     â‡ 5   # 16 bpp (1 bit alpha)         
# yes    : uncompressed_r4g4b4a4     â‡ 6   # 16 bpp (4 bit alpha)         
# yes    : uncompressed_r8g8b8a8     â‡ 7   # 32 bpp                       
# yes    : uncompressed_r32          â‡ 8   # 32 bpp (1 channel - float)   
# yes    : uncompressed_r32g32b32    â‡ 9   # 32*3 bpp (3 channels - float)
# yes    : uncompressed_r32g32b32a32 â‡ 10  # 32*4 bpp (4 channels - float)
# no     : compressed_dxt1_rgb       â‡ 11  # 4 bpp (no alpha)             
# no     : compressed_dxt1_rgba      â‡ 12  # 4 bpp (1 bit alpha)          
# no     : compressed_dxt3_rgba      â‡ 13  # 8 bpp                        
# no     : compressed_dxt5_rgba      â‡ 14  # 8 bpp                        
# no     : compressed_etc1_rgb       â‡ 15  # 4 bpp                        
# no     : compressed_etc2_rgb       â‡ 16  # 4 bpp                        
# no     : compressed_etc2_eac_rgba  â‡ 17  # 8 bpp                        
# no     : compressed_pvrt_rgb       â‡ 18  # 4 bpp                        
# no     : compressed_pvrt_rgba      â‡ 19  # 4 bpp                        
# no     : compressed_astc_4x4_rgba  â‡ 20  # 8 bpp                        
# no     : compressed_astc_8x8_rgba  â‡ 21  # 2 bpp                        

MPâ†+Ëâˆ˜Ã—â‰1â€¿âˆ

formatKeys â† "r"â€¿"g"â€¿"b"â€¿"a"â€¿"grayscale"
luminocityMat â† [
# r     g     b      a
  1    â€¿0    â€¿0     â€¿0  # r
  0    â€¿1    â€¿0     â€¿0  # g
  0    â€¿0    â€¿1     â€¿0  # b
  0    â€¿0    â€¿0     â€¿1  # a
  0.299â€¿0.587â€¿0.114 â€¿0  # grayscale
]

# returns format.râ€¿format.gâ€¿format.bâ€¿format.aâ€¿format.grayscale
# if value isn't in the namespace, replace it with 0
FormatToLengths â† {ğ•Šformat:
  {ğ•Š:0!Ëœ"Keys in format namespace need to be one of the following: "âˆ¾2â†“âˆ¾", "âŠ¸âˆ¾Â¨formatKeys
  }âŸÂ¬âˆ§Â´formatKeysâˆŠËœâ€¢ns.Keys format
  keysâ€¿vals â† (âŠ¢â‹ˆâ€¢ns.GetÂ¨)âŸœâ€¢ns.Keys ğ•© # namespace to arrays
# â”Œâ”€unsortedâ”€â”€â”€â”€â”€â”€â”   â”Œâ”€adding defaultsâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  [uFormats, ubits] â† â‰>(âˆŠkeysâˆ¾formatKeys)/(keysâ‹ˆÂ¨vals)âˆ¾formatKeysâ‹ˆÂ¨0
  Â¯1+2â‹†ubits âŠËœâ‹ formatKeys âŠ uFormats  # sorting by formats
}

LoadDataNormalized â† {formatğ•Šimage:
  bitLengths â† FormatToLengths ğ•¨
  size â† 2â†‘â‰¢image
  m â† 0â‰ bitLengths
  # pick out color data from image
  colors â† image Ã·â‰1 m/bitLengths
  # multiplying it by luminocityMat, thereby splitting rgba and grayscale into rgba components
  colors MP Ã·â‰1âŸœ(0âŠ¸=âŠ¸++Ë) m/luminocityMat
}

ReFormat â† {oldFormatâ€¿newFormatğ•Šimage:
  rgba â† oldFormat LoadDataNormalized image
  bitLengths â† FormatToLengths newFormat
  m â† 0â‰ bitLengths
  x â† â‰â¼ rgba MP â‰ m/luminocityMat
  âŒŠ0.5+xÃ—m/bitLengths
}

_Base_ â† {âŒ½ğ•—|âŒŠâˆ˜Ã·âŸœğ•—âŸ(â†•ğ•˜)} # Base _ğ•£_ Length input â†’ list


oldFormat â† {râ€¿grayscaleâ‡8â€¿8}
newFormat â† {râ‡8} # 5â€¿6â€¿5â¥ŠÂ¨1
image â† 3â€¿3â€¿2â¥Š[155â€¿255,0â€¿0]

â€¢Show oldFormatâ€¿newFormat ReFormat image

# Lets wait on this one
#  ; ğ•Š3: # uncompressed_r5g6b5 actually râ€¿gâ€¿bâ†5â€¿6â€¿5â¥ŠÂ¨1
#      rrâ€¿ggâ€¿bb â† 2â€¿2â€¿2 _Base_Â¨âŒŠ255Ã—râ€¿gâ€¿bÃ—Ã·âŸœ(+Â´)2â‹†5â€¿6â€¿5
#      (Â«âŸ10 rr) âˆ¨ (Â»âŸ6 gg) âˆ¨ Â»bb