#------------------------------------------------------------------------------------
# BQN low-level function utils
#------------------------------------------------------------------------------------

# BQN Pointer functions
# neccesary for low level programming in bqn
MovePtr  â‡ (256â‹†â†•8){-âŸœ(256Ã—â‰¥âŸœ128)256|âŒŠğ•—Ã·Ëœğ•¨+Â´ğ•—Ã—256|ğ•©}       #      bytes ğ•Š pointer # Move pointer by an amount of bytes
read     â‡ @â€¢FFI ""   â€¿"bqn_readI8Arr"  â€¿"ğ•¨>a"    â€¿">*:i8" #       data ğ•Š pointer # write data to pointer
readi8   â‡ read
readI16  â‡ @â€¢FFI ""   â€¿"bqn_readI16Arr" â€¿"ğ•¨>a"    â€¿">*:i8" #       data ğ•Š pointer # write data to pointer
readI32  â‡ @â€¢FFI ""   â€¿"bqn_readI32Arr" â€¿"ğ•¨>a"    â€¿">*:i8" #       data ğ•Š pointer # write data to pointer
make     â‡ @â€¢FFI "a"  â€¿"bqn_makeI8Vec"  â€¿"ğ•¨>u64"  â€¿">*:i8" # bytesCount ğ•Š pointer # turn data at pointer into a number array
makeI8   â‡ make
makeI16  â‡ @â€¢FFI "a"  â€¿"bqn_makeI16Vec" â€¿"ğ•¨>u64"  â€¿">*:i8" # bytesCount ğ•Š pointer # turn data at pointer into a number array
makeI32  â‡ @â€¢FFI "a"  â€¿"bqn_makeI32Vec" â€¿"ğ•¨>u64"  â€¿">*:i8" #   NumCount ğ•Š pointer # turn data at pointer into a number array
makeUTF8 â‡ @â€¢FFI "a"  â€¿"bqn_makeUTF8Str"â€¿"ğ•¨>u64"  â€¿">*:i8" #     length ğ•Š pointer # turn string at pointer into a bqn string
strLen   â‡ @â€¢FFI "i32"â€¿"strlen"         â€¿">*:i8"           #            ğ•Š pointer # length of unicode C-string

null â‡ âŸ¨âŸ©â‹ˆËœâ¼(@â€¢FFI"*"â€¿"memcpy"â€¿"*:i8"â€¿"&i8"â€¿"u64"){ğ”½}âŸ¨8â¥Š0,âŸ¨âŸ©,0âŸ©

IsNull â‡ (@â€¢FFI"*:i8"â€¿"memcpy"â€¿"*"â€¿"&i8"â€¿"u64"){
  (8â¥Š0)â‰¡âŸ¨âŸ©â‹ˆËœâ¼ğ”½âŸ¨ğ•©,âŸ¨âŸ©,0âŸ©
}

# NumCount ğ•Š pointer # turn data at pointer into a number array
MakeF32 â‡ (@â€¢FFI"*:i8"â€¿"memcpy"â€¿"&f32"â€¿"*i8"â€¿"u64"){
  bytesâ†âˆ˜â€¿4â¥Šğ•© MakeËœ ğ•¨Ã—4
  1âŠ‘âˆ˜âŠ‘Ë˜ğ”½âˆ˜{âŸ¨0âŸ©â€¿ğ•©â€¿4}Ë˜bytes
}

F32ToI8 â‡ (@â€¢FFI"*:i8"â€¿"memcpy"â€¿"&i8"â€¿"*f32"â€¿"u64"){1âŠ‘ğ”½âŸ¨(4Ã—â‰ ğ•©)â¥Š0, ğ•©, 4Ã—â‰ ğ•©âŸ©}

AllocNeeded â† {
  Alloc â† ğ•
  AllocCStr â‡ {ğ•Šstr:
    p â† (Alloc 1+â‰ str).Cast "i8"
    (â†•1+â‰ ğ•©)p.WriteÂ¨ @-Ëœğ•©âˆ¾@
    p
  }
}